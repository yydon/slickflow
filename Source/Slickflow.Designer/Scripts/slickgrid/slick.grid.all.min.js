if(typeof jQuery==="undefined"){throw"SlickGrid requires jquery module to be loaded"}if(!jQuery.fn.drag){throw"SlickGrid requires jquery.event.drag module to be loaded"}(function(C){C.extend(true,window,{"Slick":{"Event":A,"EventData":E,"EventHandler":D,"Range":B,"NonDataRow":G,"Group":F,"GroupTotals":I,"EditorLock":H,"GlobalEditorLock":new H()}});function E(){var J=false;var K=false;this.stopPropagation=function(){J=true};this.isPropagationStopped=function(){return J};this.stopImmediatePropagation=function(){K=true};this.isImmediatePropagationStopped=function(){return K}}function A(){var J=[];this.subscribe=function(K){J.push(K)};this.unsubscribe=function(K){for(var L=J.length-1;L>=0;L--){if(J[L]===K){J.splice(L,1)}}};this.notify=function(L,N,O){N=N||new E();O=O||this;var K;for(var M=0;M<J.length&&!(N.isPropagationStopped()||N.isImmediatePropagationStopped());M++){K=J[M].call(O,N,L)}return K}}function D(){var J=[];this.subscribe=function(L,K){J.push({event:L,handler:K});L.subscribe(K);return this};this.unsubscribe=function(L,K){var M=J.length;while(M--){if(J[M].event===L&&J[M].handler===K){J.splice(M,1);L.unsubscribe(K);return}}return this};this.unsubscribeAll=function(){var K=J.length;while(K--){J[K].event.unsubscribe(J[K].handler)}J=[];return this}}function B(J,M,K,L){if(K===undefined&&L===undefined){K=J;L=M}this.fromRow=Math.min(J,K);this.fromCell=Math.min(M,L);this.toRow=Math.max(J,K);this.toCell=Math.max(M,L);this.isSingleRow=function(){return this.fromRow==this.toRow};this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell};this.contains=function(N,O){return N>=this.fromRow&&N<=this.toRow&&O>=this.fromCell&&O<=this.toCell};this.toString=function(){if(this.isSingleCell()){return"("+this.fromRow+":"+this.fromCell+")"}else{return"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}}function G(){this.__nonDataRow=true}function F(){this.__group=true;this.__updated=false;this.count=0;this.value=null;this.title=null;this.collapsed=false;this.totals=null}F.prototype=new G();F.prototype.equals=function(J){return this.value===J.value&&this.count===J.count&&this.collapsed===J.collapsed};function I(){this.__groupTotals=true;this.group=null}I.prototype=new G();function H(){var J=null;this.isActive=function(L){return(L?J===L:J!==null)};this.activate=function(L){if(L===J){return}if(J!==null){throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController"}if(!L.commitCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()"}if(!L.cancelCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()"}J=L};this.deactivate=function(L){if(J!==L){throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one"}J=null};this.commitCurrentEdit=function(){return(J?J.commitCurrentEdit():true)};this.cancelCurrentEdit=function K(){return(J?J.cancelCurrentEdit():true)}}})(jQuery);if(typeof Slick==="undefined"){throw"slick.core.js not loaded"}(function(D){D.extend(true,window,{"Slick":{"Formatters":{"PercentComplete":G,"PercentCompleteBar":H,"YesNo":F,"Checkmark":A,"RowNumber":B,"DataTime":E,"HyperLinkInTab":I,"HyperLinkNewPage":J,"VerCellMerged":C}}});function G(M,O,K,L,N){if(K==null||K===""){return"-"}else{if(K<50){return"<span style='color:red;font-weight:bold;'>"+K+"%</span>"}else{return"<span style='color:green'>"+K+"%</span>"}}}function H(N,P,K,M,O){if(K==null||K===""){return""}var L;if(K<30){L="red"}else{if(K<70){L="silver"}else{L="green"}}return"<span class='percent-complete-bar' style='background:"+L+";width:"+K+"%'></span>"}function F(M,O,K,L,N){return K?"Yes":"No"}function A(M,O,K,L,N){return K?"<img src='/Common/Content/default/images/tick.png'>":""}function C(S,Q,O,L,P){var K=window._renderOptions;if(K.lastRendering!=1){return}var M=window.getRenderDataItmes();var U=L.field;var N=M.length;var R=M[S];var T=S+1;if(T<N){var V=M[T][U];if(O==V){if(!K.changedCells[S]){K.changedCells[S]={}}K.changedCells[S][U]="noneline-bottom";K.isNextMerged=1;return O}else{if(K.isNextMerged==1){K.isNextMerged=0;return}}}return O}function I(R,Q,N,L,O){var M=L.linkAction;var P=M();var P=P+"("+R+");";var K="<a href='#' onclick='"+P+"' rowIndex='"+R+"'>"+N+"</a>";return K}function J(O,Q,L,N,P){var M=N.linkAction;var K=M(P);return"<a href='"+N.linkUrl+K+"' target='_blank'>"+L+"</a>"}function B(M,O,K,L,N){return M+1}function E(M,O,K,L,N){if(K!=null&&K!=""){return K.substring(0,10)}}})(jQuery);(function(D){D.extend(true,window,{"Slick":{"Editors":{"Text":A,"Integer":B,"Decimal":G,"Date":J,"DropDownList":K,"DropDownWithText":E,"YesNoSelect":C,"Checkbox":M,"TextButton":L,"PercentComplete":I,"LongText":H,"SelectCell":F}}});function A(O){var P;var N;var Q=this;this.init=function(){P=D("<INPUT type=text class='editor-text' />").bind("dblclick",function(R){return O.grid.onDblClick.notify(O,R,this)}).bind("keydown.nav",function(R){if(R.keyCode===D.ui.keyCode.LEFT||R.keyCode===D.ui.keyCode.RIGHT){R.stopImmediatePropagation()}}).appendTo(O.container).focus().select()};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.getValue=function(){return P.val()};this.setValue=function(R){P.val(R)};this.loadValue=function(R){N=R[O.column.field]||"";P.val(N);P[0].defaultValue=N;P.select()};this.serializeValue=function(){return P.val()};this.applyValue=function(S,R){S[O.column.field]=R};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&(P.val()!=N)};this.validate=function(){var S=O.column.validator;if(S&&S.required){var R=P.val();if(!R||R.length==0){return{valid:false,msg:"字段:["+O.column.name+"]不能为空！"}}else{if(S.maxlength){if(R.length>S.maxlength){return{valid:false,msg:"字段:["+O.column.name+"]长度超过最大输入长度:"+S.maxlength}}}}}if(O.column.validate){var T=O.column.validate(P.val());if(!T.valid){return T}}return{valid:true,msg:null}};this.init()}function B(O){var P;var N;var Q=this;this.init=function(){P=D("<INPUT type=text class='editor-text' />");P.bind("keydown.nav",function(R){if(R.keyCode===D.ui.keyCode.LEFT||R.keyCode===D.ui.keyCode.RIGHT){R.stopImmediatePropagation()}});P.appendTo(O.container);P.focus().select()};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.loadValue=function(R){N=R[O.column.field];P.val(N);P[0].defaultValue=N;P.select()};this.serializeValue=function(){return parseInt(P.val(),10)||0};this.applyValue=function(S,R){S[O.column.field]=R};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&(P.val()!=N)};this.validate=function(){if(isNaN(P.val())){return{valid:false,msg:"Please enter a valid integer"}}return{valid:true,msg:null}};this.init()}function G(O){var P;var N;var Q=this;this.init=function(){P=D("<INPUT type=text class='editor-text' />");P.bind("keydown.nav",function(R){if(R.keyCode===D.ui.keyCode.LEFT||R.keyCode===D.ui.keyCode.RIGHT){R.stopImmediatePropagation()}});P.appendTo(O.container);P.focus().select()};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.loadValue=function(R){N=R[O.column.field];P.val(N);P[0].defaultValue=N;P.select()};this.serializeValue=function(){return parseFloat(P.val(),10)||0};this.applyValue=function(S,R){S[O.column.field]=R};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&(P.val()!=N)};this.validate=function(){if(isNaN(P.val())){return{valid:false,msg:"Please enter a valid integer"}}return{valid:true,msg:null}};this.init()}function J(O){var P;var N;var R=this;var Q=false;this.init=function(){P=D("<INPUT type=text class='editor-text' />");P.appendTo(O.container);P.focus().select();P.datepicker({showOn:"button",buttonImageOnly:true,buttonImage:"/Common/Content/default/images/calendar.gif",beforeShow:function(){Q=true},onClose:function(){Q=false}});P.width(P.width()-18)};this.destroy=function(){D.datepicker.dpDiv.stop(true,true);P.datepicker("hide");P.datepicker("destroy");P.remove()};this.show=function(){if(Q){D.datepicker.dpDiv.stop(true,true).show()}};this.hide=function(){if(Q){D.datepicker.dpDiv.stop(true,true).hide()}};this.position=function(S){if(!Q){return}D.datepicker.dpDiv.css("top",S.top+30).css("left",S.left)};this.focus=function(){P.focus()};this.loadValue=function(S){N=S[O.column.field];P.val(N);P[0].defaultValue=N;P.select()};this.serializeValue=function(){return P.val()};this.applyValue=function(T,S){T[O.column.field]=S};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&(P.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init()}function K(O){var P=D("");var N="";var S=this;var R=O.grid.$selDropdownlistDatasource;var Q=O.grid.$selDropdownlistChangedEvent;this.init=function(){if(R!=undefined&&R!=null){P=this.preRender(O.grid.$selDropdownlistDatasource);if(Q!=null){P.change(function(){Q(this,{"ID":P.val(),"txt":P.find("option:selected").text()})})}P.appendTo(O.container);P.focus()}};this.preRender=function(W){var Z="";var Y="<SELECT tabIndex='0' class='editor-select'><OPTION value='-1'></OPTION>";var X="</SELECT>";var T=W.length;if(T>0&&W[0].txt!=undefined){for(var V=0;V<T;V++){Z+="<OPTION value='"+W[V].ID+"'>"+W[V].txt+"</OPTION>"}}else{for(var V=0;V<T;V++){Z+="<OPTION value='"+W[V].ID+"'>"+W[V].Text+"</OPTION>"}}var U=Y+Z+X;return D(U)};this.destroy=function(){D(O.container).empty()};this.focus=function(){P.focus()};this.serializeValue=function(){if(P.val()!=-1){return P.find("option:selected").text()}};this.applyValue=function(U,T){if(T!=undefined){U[O.column.field]=T}};this.loadValue=function(T){N=T[O.column.field]};this.isValueChanged=function(){return(P.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init();return P.val()}function E(O){var Q=D("");var N="";var S=this;var P=O.grid.$selDropdownlistDatasource;var R=O.grid.$selDropdownlistChangedEvent;this.init=function(){if(P!=undefined&&P!=null){Q=this.preRender(P);Q.appendTo(O.container);if(R!=null){Q.editableSelect().change(function(U){var V=-1;var W=Q.data("editableSelect").editableSelect.$textbox.val();var T=jQuery.grep(P,function(X){return X.txt==W});if(T&&T.length==1){V=T[0].ID}R(this,{"ID":V,"txt":W})})}Q.focus()}};this.preRender=function(W){var Z="";var Y="<SELECT tabIndex='0' class='makeEditable editor-select'><OPTION value='-1'></OPTION>";var X="</SELECT>";var T=W.length;if(T>0&&W[0].txt!=undefined){for(var V=0;V<T;V++){Z+="<OPTION value='"+W[V].ID+"'>"+W[V].txt+"</OPTION>"}}else{for(var V=0;V<T;V++){Z+="<OPTION value='"+W[V].ID+"'>"+W[V].Text+"</OPTION>"}}var U=Y+Z+X;return D(U)};this.destroy=function(){D(O.container).empty()};this.focus=function(){Q.focus()};this.serializeValue=function(){var W=Q.data("editableSelect").editableSelect.$textbox.val();if(W&&W!=""){if(!(P||P[0].xdata)){return W}var V;var U=jQuery.grep(P,function(X){return X.txt==W});if(U&&U.length==1){V=U[0].xdata}if(!V){return W}return V}if(W==""){var T=Q.data("editableSelect").editableSelect.$textbox.data("isDel");if(T==true){return""}}};this.applyValue=function(U,T){if(T!=undefined){U[O.column.field]=T}};this.loadValue=function(T){N=T[O.column.field]};this.isValueChanged=function(){return(Q.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init();return Q.val()}function C(O){var P;var N;var Q=this;this.init=function(){P=D("<SELECT tabIndex='0' class='editor-yesno'><OPTION value='yes'>Yes</OPTION><OPTION value='no'>No</OPTION></SELECT>");P.appendTo(O.container);P.focus()};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.loadValue=function(R){P.val((N=R[O.column.field])?"yes":"no");P.select()};this.serializeValue=function(){return(P.val()=="yes")};this.applyValue=function(S,R){S[O.column.field]=R};this.isValueChanged=function(){return(P.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init()}function L(O){var P;var R;var Q;var N;var S=this;this.init=function(){var T=D(O.container).width()-17;P=D("<INPUT type='text' class='editor-text' style='width:"+T+"px'/><INPUT type='button' class='editor-button hideFocus' style='width:16px;height:17px;font-size:10px;text-align:top;'/>").appendTo(O.container);R=D(P[0]);Q=D(P[1]);R.bind("keydown.nav",function(U){if(U.keyCode==D.ui.keyCode.LEFT||U.keyCode==D.ui.keyCode.RIGHT){U.stopImmediatePropagation()}});Q.bind("click",O,function(U){U.stopImmediatePropagation();O.grid.onTextButtonClick(O)})};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.getValue=function(){return R.val()};this.setValue=function(T){R.val(T)};this.loadValue=function(T){N=T[O.column.field]||"";R.val(N);R[0].defaultValue=N;R.select()};this.serializeValue=function(){var T=O.container.textContent;if(T){return T}else{return R.val()}};this.applyValue=function(U,T){U[O.column.field]=T;R.val(T)};this.isValueChanged=function(){var T=O.container.textContent;if((T!=null)&&(T!=N)){return true}else{return(!(R.val()==""&&N==null))&&(R.val()!=N)}};this.validate=function(){if(O.column.validator){var T=O.column.validator(R.val());if(!T.valid){return T}}return{valid:true,msg:null}};this.init()}function M(O){var P;var N;var Q=this;this.init=function(){P=D("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>");P.appendTo(O.container);P.focus()};this.destroy=function(){P.remove()};this.focus=function(){P.focus()};this.loadValue=function(R){N=R[O.column.field];if(N){P.attr("checked","checked")}else{P.removeAttr("checked")}};this.serializeValue=function(){return P.attr("checked")};this.applyValue=function(S,R){if(R=="checked"){S[O.column.field]=true}else{S[O.column.field]=false}};this.isValueChanged=function(){return(P.attr("checked")!=N)};this.validate=function(){return{valid:true,msg:null}};this.init()}function I(O){var P,Q;var N;var R=this;this.init=function(){P=D("<INPUT type=text class='editor-percentcomplete' />");P.width(D(O.container).innerWidth()-25);P.appendTo(O.container);Q=D("<div class='editor-percentcomplete-picker' />").appendTo(O.container);Q.append("<div class='editor-percentcomplete-helper'><div class='editor-percentcomplete-wrapper'><div class='editor-percentcomplete-slider' /><div class='editor-percentcomplete-buttons' /></div></div>");Q.find(".editor-percentcomplete-buttons").append("<button val=0>Not started</button><br/><button val=50>In Progress</button><br/><button val=100>Complete</button>");P.focus().select();Q.find(".editor-percentcomplete-slider").slider({orientation:"vertical",range:"min",value:N,slide:function(T,S){P.val(S.value)}});Q.find(".editor-percentcomplete-buttons button").bind("click",function(S){P.val(D(this).attr("val"));Q.find(".editor-percentcomplete-slider").slider("value",D(this).attr("val"))})};this.destroy=function(){P.remove();Q.remove()};this.focus=function(){P.focus()};this.loadValue=function(S){P.val(N=S[O.column.field]);P.select()};this.serializeValue=function(){return parseInt(P.val(),10)||0};this.applyValue=function(T,S){T[O.column.field]=S};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&((parseInt(P.val(),10)||0)!=N)};this.validate=function(){if(isNaN(parseInt(P.val(),10))){return{valid:false,msg:"Please enter a valid positive number"}}return{valid:true,msg:null}};this.init()}function H(O){var P,R;var N;var Q=this;this.init=function(){var S=D("body");R=D("<DIV style='z-index:10000;position:absolute;background:white;padding:5px;border:3px solid gray; -moz-border-radius:10px; border-radius:10px;'/>").appendTo(S);P=D("<TEXTAREA hidefocus rows=5 style='backround:white;width:250px;height:80px;border:0;outline:0'>").appendTo(R);D("<DIV style='text-align:right'><BUTTON>Save</BUTTON><BUTTON>Cancel</BUTTON></DIV>").appendTo(R);R.find("button:first").bind("click",this.save);R.find("button:last").bind("click",this.cancel);P.bind("keydown",this.handleKeyDown);Q.position(O.position);P.focus().select()};this.handleKeyDown=function(S){if(S.which==D.ui.keyCode.ENTER&&S.ctrlKey){Q.save()}else{if(S.which==D.ui.keyCode.ESCAPE){S.preventDefault();Q.cancel()}else{if(S.which==D.ui.keyCode.TAB&&S.shiftKey){S.preventDefault();O.grid.navigatePrev()}else{if(S.which==D.ui.keyCode.TAB){S.preventDefault();O.grid.navigateNext()}}}}};this.save=function(){O.commitChanges()};this.cancel=function(){P.val(N);O.cancelChanges()};this.hide=function(){R.hide()};this.show=function(){R.show()};this.position=function(S){R.css("top",S.top-5).css("left",S.left-5)};this.destroy=function(){R.remove()};this.focus=function(){P.focus()};this.loadValue=function(S){P.val(N=S[O.column.field]);P.select()};this.serializeValue=function(){return P.val()};this.applyValue=function(T,S){T[O.column.field]=S};this.isValueChanged=function(){return(!(P.val()==""&&N==null))&&(P.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init()}function F(O){var P;var N;var Q=this;this.init=function(){if(O.column.options){opt_values=O.column.options.split(",")}else{opt_values="yes,no".split(",")}option_str="";for(i in opt_values){v=opt_values[i];option_str+="<OPTION value='"+v+"'>"+v+"</OPTION>"}P=D("<SELECT tabIndex='0' class='editor-select'>"+option_str+"</SELECT>");P.appendTo(O.container);P.focus()};this.destory=function(){P.remove()};this.focus=function(){P.focus()};this.loadValue=function(R){N=R[arg.column.field];P.val(N)};this.serializeValue=function(){if(O.column.options){return P.val()}else{return(P.val()=="yes")}};this.applyValue=function(S,R){S[O.column.field]=stat};this.isValueChanged=function(){return(P.val()!=N)};this.validate=function(){return{valid:true,msg:null}};this.init()}})(jQuery);(function($){$.extend(true,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions;var maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={explicitInitialization:false,rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,enableCellNavigation:true,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:50,autoHeight:false,editorLock:Slick.GlobalEditorLock,showTopPanel:false,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:true,enableTextSelectionOnCells:false,dataItemColumnValueExtractor:null,frozenColumn:-1,fullWidthRows:false,multiColumnSort:false,defaultFormatter:defaultFormatter,forceSyncScrolling:false};var columnDefaults={name:"",resizable:true,sortable:false,minWidth:30,rerenderOnResize:false,headerCssClass:null,defaultSortAsc:true};var th;var h;var ph;var n;var cj;var page=0;var offset=0;var vScrollDir=1;var initialized=false;var $container;var uid="slickgrid_"+Math.round(1000000*Math.random());var self=this;var $focusSink,$focusSink2;var $headerScroller;var $headers;var $topPanel;var $viewport;var $canvas;var $style;var $boundAncestors;var stylesheet,columnCssRulesL,columnCssRulesR;var viewportH,viewportW;var canvasWidth,canvasWidthL,canvasWidthR;var headersWidth,headersWidthL,headersWidthR;var viewportHasHScroll,viewportHasVScroll;var headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0;var absoluteColumnMinWidth;var numberOfRows=0;var paneTopH=0;var viewportTopH=0;var topPanelH=0;var tabbingDirection=1;var $activeCanvasNode;var $activeViewportNode;var activePosX;var activeRow,activeCell;var activeCellNode=null;var currentEditor=null;var serializedEditorValue;var editController;var rowsCache={};var renderedRows=0;var numVisibleRows;var prevScrollTop=0;var scrollTop=0;var lastRenderedScrollTop=0;var lastRenderedScrollLeft=0;var prevScrollLeft=0;var scrollLeft=0;var selectionModel;var selectedRows=[];var plugins=[];var cellCssClasses={};var columnsById={};var sortColumns=[];var columnPosLeft=[];var columnPosRight=[];var h_editorLoader=null;var h_render=null;var h_postrender=null;var postProcessedRows={};var postProcessToRow=null;var postProcessFromRow=null;var counter_rows_rendered=0;var counter_rows_removed=0;var $paneHeaderL;var $paneHeaderR;var $paneTopL;var $paneTopR;var $headerScrollerL;var $headerScrollerR;var $headerL;var $headerR;var $viewportTopL;var $viewportTopR;var $canvasTopL;var $canvasTopR;var $headerScrollContainer;var $viewportScrollContainerX;var $viewportScrollContainerY;function init(){$container=$(container);if($container.length<1){throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.")}maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight();scrollbarDimensions=scrollbarDimensions||measureScrollbar();options=$.extend({},defaults,options);validateAndEnforceOptions();columnDefaults.width=options.defaultColumnWidth;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}if(options.enableColumnReorder&&!$.fn.sortable){throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded")}editController={"commitCurrentEdit":commitCurrentEdit,"cancelCurrentEdit":cancelCurrentEdit};$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget");if(!/relative|absolute|fixed/.test($container.css("position"))){$container.css("position","relative")}$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container);$paneHeaderL=$("<div class='slick-pane slick-pane-header slick-pane-left' tabIndex='0' />").appendTo($container);$paneHeaderR=$("<div class='slick-pane slick-pane-header slick-pane-right' tabIndex='0' />").appendTo($container);$paneTopL=$("<div class='slick-pane slick-pane-top slick-pane-left' tabIndex='0' />").appendTo($container);$paneTopR=$("<div class='slick-pane slick-pane-top slick-pane-right' tabIndex='0' />").appendTo($container);$headerScrollerL=$("<div class='ui-state-default slick-header slick-header-left' />").appendTo($paneHeaderL);$headerScrollerR=$("<div class='ui-state-default slick-header slick-header-right' />").appendTo($paneHeaderR);$headerScroller=$().add($headerScrollerL).add($headerScrollerR);$headerL=$("<div class='slick-header-columns slick-header-columns-left' style='left:-1000px' />").appendTo($headerScrollerL);$headerR=$("<div class='slick-header-columns slick-header-columns-right' style='left:-1000px' />").appendTo($headerScrollerR);$headers=$().add($headerL).add($headerR);$viewportTopL=$("<div class='slick-viewport slick-viewport-top slick-viewport-left' tabIndex='0' hideFocus />").appendTo($paneTopL);$viewportTopR=$("<div class='slick-viewport slick-viewport-top slick-viewport-right' tabIndex='0' hideFocus />").appendTo($paneTopR);$viewport=$().add($viewportTopL).add($viewportTopR);$activeViewportNode=$viewportTopL;$canvasTopL=$("<div class='grid-canvas grid-canvas-top grid-canvas-left' tabIndex='0' hideFocus />").appendTo($viewportTopL);$canvasTopR=$("<div class='grid-canvas grid-canvas-top grid-canvas-right' tabIndex='0' hideFocus />").appendTo($viewportTopR);$canvas=$().add($canvasTopL).add($canvasTopR);$activeCanvasNode=$canvasTopL;$focusSink2=$focusSink.clone().appendTo($container);if(!options.explicitInitialization){finishInitialization()}var visibleColumns=getVisibleColumns();setColumns(visibleColumns)}function getVisibleColumns(){var visibleColumns=jQuery.grep(columns,function(x){return x.visible!=false});return visibleColumns}function getGridId(){return uid}function finishInitialization(){if(!initialized){initialized=true;getViewportWidth();getViewportHeight();measureCellPaddingAndBorder();disableSelection($headers);if(!options.enableTextSelectionOnCells){$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")})}setFrozenOptions();setPaneVisibility();setScroller();setOverflow();updateColumnCaches();createColumnHeaders();setupColumnSort();createCssRules();resizeCanvas();bindAncestorScrollEvents();$container.bind("resize.slickgrid",resizeCanvas);$viewport.bind("scroll",handleScroll);if(jQuery.fn.mousewheel&&(options.frozenColumn>-1)){$viewport.bind("mousewheel",handleMouseWheel)}$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave);$focusSink.add($focusSink2).bind("keydown",handleKeyDown);$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).bind("mouseleave",handleCanvasMouseLeave).delegate(".slick-row","mouseenter",handleRowMouseEnter).delegate(".slick-row","mouseleave",handleRowMouseLeave).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave)}}function registerPlugin(plugin){plugins.unshift(plugin);plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--){if(plugins[i]===plugin){if(plugins[i].destroy){plugins[i].destroy()}plugins.splice(i,1);break}}}function setSelectionModel(model){if(selectionModel){selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);if(selectionModel.destroy){selectionModel.destroy()}}selectionModel=model;if(selectionModel){selectionModel.init(self);selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged)}}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function getActiveCanvasNode(element){setActiveCanvasNode(element);return $activeCanvasNode[0]}function getCanvases(){return $canvas}function setActiveCanvasNode(element){if(element){$activeCanvasNode=$(element.target).closest(".grid-canvas")}}function getViewportNode(){return $viewport[0]}function getActiveViewportNode(element){setActiveViewPortNode(element);return $activeViewportNode[0]}function setActiveViewportNode(element){if(element){$activeViewportNode=$(element.target).closest(".slick-viewport")}}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");var dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();return dim}function getHeadersWidth(){headersWidth=headersWidthL=headersWidthR=0;for(var i=0,ii=columns.length;i<ii;i++){var width=columns[i].width;if((options.frozenColumn)>-1&&(i>options.frozenColumn)){headersWidthR+=width}else{headersWidthL+=width}}if(options.frozenColumn>-1){headersWidthL=headersWidthL+1000;headersWidthR=Math.max(headersWidthR,viewportW)+headersWidthL;headersWidthR+=scrollbarDimensions.width}else{headersWidthL+=scrollbarDimensions.width;headersWidthL=Math.max(headersWidthL,viewportW)+1000}headersWidth=headersWidthL+headersWidthR}function getCanvasWidth(){var availableWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;var i=columns.length;canvasWidthL=canvasWidthR=0;while(i--){if((options.frozenColumn>-1)&&(i>options.frozenColumn)){canvasWidthR+=columns[i].width}else{canvasWidthL+=columns[i].width}}var totalRowWidth=canvasWidthL+canvasWidthR;return options.fullWidthRows?Math.max(totalRowWidth,availableWidth):totalRowWidth}function updateCanvasWidth(forceColumnWidthsUpdate){var oldCanvasWidth=canvasWidth;var oldCanvasWidthL=canvasWidthL;var oldCanvasWidthR=canvasWidthR;var widthChanged;canvasWidth=getCanvasWidth();widthChanged=canvasWidth!==oldCanvasWidth||canvasWidthL!==oldCanvasWidthL||canvasWidthR!==oldCanvasWidthR;if(widthChanged||options.frozenColumn>-1){$canvasTopL.width(canvasWidthL);getHeadersWidth();$headerL.width(headersWidthL);$headerR.width(headersWidthR);if(options.frozenColumn>-1){$canvasTopR.width(canvasWidthR);$paneHeaderL.width(canvasWidthL);$paneHeaderR.css("left",canvasWidthL);$paneHeaderR.css("top",0);$paneTopL.width(canvasWidthL);$paneTopR.css("left",canvasWidthL);$viewportTopL.width(canvasWidthL);$viewportTopR.width(viewportW-canvasWidthL)}else{}viewportHasHScroll=(canvasWidth>viewportW-scrollbarDimensions.width)}if(widthChanged||forceColumnWidthsUpdate){applyColumnWidths()}}function disableSelection($target){if($target&&$target.jquery){$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}}function getMaxSupportedCssHeight(){var supportedHeight=1000000;var testUpTo=($.browser.mozilla)?6000000:1000000000;var div=$("<div style='display:none' />").appendTo(document.body);while(true){var test=supportedHeight*2;div.css("height",test);if(test>testUpTo||div.height()!==test){break}else{supportedHeight=test}}div.remove();return supportedHeight}function bindAncestorScrollEvents(){var elem=$canvasTopL[0];while((elem=elem.parentNode)!=document.body&&elem!=null){if(elem==$viewportTopL[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){var $elem=$(elem);if(!$boundAncestors){$boundAncestors=$elem}else{$boundAncestors=$boundAncestors.add($elem)}$elem.bind("scroll."+uid,handleActiveCellPositionChange)}}}function unbindAncestorScrollEvents(){if(!$boundAncestors){return}$boundAncestors.unbind("scroll."+uid);$boundAncestors=null}function updateColumnHeader(columnId,title,toolTip){if(!initialized){return}var idx=getColumnIndex(columnId);if(idx==null){return}var columnDef=columns[idx];var $header=$headers.children().eq(idx);if($header){if(title!==undefined){columns[idx].name=title}if(toolTip!==undefined){columns[idx].toolTip=toolTip}trigger(self.onBeforeHeaderCellDestroy,{"node":$header[0],"column":columnDef});$header.attr("title",toolTip||"").children().eq(0).html(title);trigger(self.onHeaderCellRendered,{"node":$header[0],"column":columnDef})}}function createColumnHeaders(){function hoverBegin(){$(this).addClass("ui-state-hover")}function hoverEnd(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var columnDef=$(this).data("column");if(columnDef){trigger(self.onBeforeHeaderCellDestroy,{"node":this,"column":columnDef})}});$headerL.empty();$headerR.empty();getHeadersWidth();$headerL.width(headersWidthL);$headerR.width(headersWidthR);var maxSpanHeight=16;var divHeaderID;var divHeaderCSS="dHCss0x9liY86gong"+uid;for(var i=0;i<columns.length;i++){var m=columns[i];var $headerTarget=(options.frozenColumn>-1)?((i<=options.frozenColumn)?$headerL:$headerR):$headerL;divHeaderID=uid+m.id;var header=$("<div class='ui-state-default slick-header-column "+divHeaderCSS+"' id='"+divHeaderID+"' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("title",m.toolTip||"").data("column",m).addClass(m.headerCssClass||"").appendTo($headerTarget);var divHeader=$("#"+divHeaderID);var spanHeader=divHeader.children().first();if(spanHeader.height()>divHeader.height()&&spanHeader.height()>maxSpanHeight){maxSpanHeight=spanHeader.height()}if(options.enableColumnReorder||m.sortable){header.hover(hoverBegin,hoverEnd)}if(m.sortable){header.addClass("slick-header-sortable");header.append("<span class='slick-sort-indicator' />")}trigger(self.onHeaderCellRendered,{"node":header[0],"column":m})}$("div."+divHeaderCSS).css("height",maxSpanHeight);setSortColumns(sortColumns);setupColumnResize();if(options.enableColumnReorder){setupColumnReorder()}}function setupColumnSort(){$headers.click(function(e){e.metaKey=e.metaKey||e.ctrlKey;if($(e.target).hasClass("slick-resizable-handle")){return}var $col=$(e.target).closest(".slick-header-column");if(!$col.length){return}var column=$col.data("column");if(column.sortable){if(!getEditorLock().commitCurrentEdit()){return}var sortOpts=null;var i=0;for(;i<sortColumns.length;i++){if(sortColumns[i].columnId==column.id){sortOpts=sortColumns[i];sortOpts.sortAsc=!sortOpts.sortAsc;break}}if(e.metaKey&&options.multiColumnSort){if(sortOpts){sortColumns.splice(i,1)}}else{if((!e.shiftKey&&!e.metaKey)||!options.multiColumnSort){sortColumns=[]}if(!sortOpts){sortOpts={columnId:column.id,sortAsc:true};sortColumns.push(sortOpts)}else{if(sortColumns.length==0){sortColumns.push(sortOpts)}}}setSortColumns(sortColumns);if(!options.multiColumnSort){trigger(self.onSort,{multiColumnSort:false,sortCol:column,sortAsc:sortOpts.sortAsc},e)}else{trigger(self.onSort,{multiColumnSort:true,sortCols:$.map(sortColumns,function(col){return{sortCol:columns[getColumnIndex(col.columnId)],sortAsc:col.sortAsc}})},e)}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy");var columnScrollTimer=null;function scrollColumnsRight(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft+10}function scrollColumnsLeft(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft-10}$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(e,ui){$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},sort:function(e,ui){if(e.originalEvent.pageX>$container[0].clientWidth){}else{if(e.originalEvent.pageX<$viewportScrollContainerX.offset().left){}else{clearInterval(columnScrollTimer);columnScrollTimer=null}}},stop:function(e){clearInterval(columnScrollTimer);columnScrollTimer=null;if(!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var reorderedIds=$headerL.sortable("toArray");reorderedIds=reorderedIds.concat($headerR.sortable("toArray"));var reorderedColumns=[];for(var i=0;i<reorderedIds.length;i++){reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))])}setColumns(reorderedColumns);trigger(self.onColumnsReordered,{});e.stopPropagation();setupColumnResize()}})}function setupColumnResize(){var $col,j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable;columnElements=$headers.children();columnElements.find(".slick-resizable-handle").remove();columnElements.each(function(i,e){if(columns[i].resizable){if(firstResizable===undefined){firstResizable=i}lastResizable=i}});if(firstResizable===undefined){return}columnElements.each(function(i,e){if(i<firstResizable||(options.forceFitColumns&&i>=lastResizable)){return}$col=$(e);$("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,dd){if(!getEditorLock().commitCurrentEdit()){return false}pageX=e.pageX;$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()});if(options.forceFitColumns){shrinkLeewayOnRight=0;stretchLeewayOnRight=0;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnRight!==null){if(c.maxWidth){stretchLeewayOnRight+=c.maxWidth-c.previousWidth}else{stretchLeewayOnRight=null}}shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}}var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnLeft!==null){if(c.maxWidth){stretchLeewayOnLeft+=c.maxWidth-c.previousWidth}else{stretchLeewayOnLeft=null}}shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}if(shrinkLeewayOnRight===null){shrinkLeewayOnRight=100000}if(shrinkLeewayOnLeft===null){shrinkLeewayOnLeft=100000}if(stretchLeewayOnRight===null){stretchLeewayOnRight=100000}if(stretchLeewayOnLeft===null){stretchLeewayOnLeft=100000}maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft);minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight)}).bind("drag",function(e,dd){var actualMinWidth,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX,x;if(d<0){x=d;var newCanvasWidthL=0,newCanvasWidthR=0;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}for(k=0;k<=i;k++){c=columns[k];if((options.frozenColumn>-1)&&(k>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}if((options.frozenColumn>-1)&&(j>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}}}else{for(j=i+1;j<columnElements.length;j++){c=columns[j];if((options.frozenColumn>-1)&&(j>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}}}else{x=d;var newCanvasWidthL=0,newCanvasWidthR=0;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}for(k=0;k<=i;k++){c=columns[k];if((options.frozenColumn>-1)&&(k>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}if((options.frozenColumn>-1)&&(j>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}}}else{for(j=i+1;j<columnElements.length;j++){c=columns[j];if((options.frozenColumn>-1)&&(j>options.frozenColumn)){newCanvasWidthR+=c.width}else{newCanvasWidthL+=c.width}}}}if(options.frozenColumn>-1&&newCanvasWidthL!=canvasWidthL){$headerL.width(newCanvasWidthL+1000);$paneHeaderR.css("left",newCanvasWidthL)}applyColumnHeaderWidths();if(options.syncColumnCellResize){updateCanvasWidth();applyColumnWidths()}}).bind("dragend",function(e,dd){var newWidth;$(this).parent().removeClass("slick-header-column-active");for(j=0;j<columnElements.length;j++){c=columns[j];newWidth=$(columnElements[j]).outerWidth();if(c.previousWidth!==newWidth&&c.rerenderOnResize){invalidateAllRows()}}updateCanvasWidth(true);render();trigger(self.onColumnsResized,{})})})}function getVBoxDelta($el){var p=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var delta=0;$.each(p,function(n,val){delta+=parseFloat($el.css(val))||0});return delta}function setFrozenOptions(){options.frozenColumn=(options.frozenColumn>=0&&options.frozenColumn<columns.length)?parseInt(options.frozenColumn):-1}function setPaneVisibility(){if(options.frozenColumn>-1){$paneHeaderR.show();$paneTopR.show()}else{$paneHeaderR.hide();$paneTopR.hide()}}function setOverflow(){if(options.frozenColumn>-1){$viewportTopL.css({"overflow-x":"scroll","overflow-y":"hidden"});$viewportTopR.css({"overflow-x":"scroll","overflow-y":"auto"})}else{$viewportTopL.css({"overflow-x":"auto","overflow-y":"auto"});$viewportTopR.css({"overflow-x":"auto","overflow-y":"auto"})}}function setScroller(){if(options.frozenColumn>-1){$headerScrollContainer=$headerScrollerR;$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopR}else{$headerScrollContainer=$headerScrollerL;$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopL}}function measureCellPaddingAndBorder(){var el;var h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=headerColumnHeightDiff=0;$.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0});el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);cellWidthDiff=cellHeightDiff=0;$.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0});r.remove();absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));var rowHeight=(options.rowHeight-cellHeightDiff);var rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"];for(var i=0;i<columns.length;i++){rules.push("."+uid+" .l"+i+" { }");rules.push("."+uid+" .r"+i+" { }")}if($style[0].styleSheet){$style[0].styleSheet.cssText=rules.join(" ")}else{$style[0].appendChild(document.createTextNode(rules.join(" ")))}}function getColumnCssRules(idx){if(!stylesheet){var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}}if(!stylesheet){throw new Error("Cannot find stylesheet.")}columnCssRulesL=[];columnCssRulesR=[];var cssRules=(stylesheet.cssRules||stylesheet.rules);var matches,columnIdx;for(var i=0;i<cssRules.length;i++){var selector=cssRules[i].selectorText;if(matches=/\.l\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesL[columnIdx]=cssRules[i]}else{if(matches=/\.r\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesR[columnIdx]=cssRules[i]}}}}return{"left":columnCssRulesL[idx],"right":columnCssRulesR[idx]}}function removeCssRules(){$style.remove();stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit();trigger(self.onBeforeDestroy,{});var i=plugins.length;while(i--){unregisterPlugin(plugins[i])}if(options.enableColumnReorder){$headers.filter(":ui-sortable").sortable("destroy")}unbindAncestorScrollEvents();$container.unbind(".slickgrid");removeCssRules();$canvas.unbind("draginit dragstart dragend drag");$container.empty().removeClass(uid)}function trigger(evt,args,e){e=e||new Slick.EventData();args=args||{};args.grid=self;return evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,widths=[],shrinkLeeway=0,total=0,prevTotal,availWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++){c=columns[i];widths.push(c.width);total+=c.width;if(c.resizable){shrinkLeeway+=c.width-Math.max(c.minWidth,absoluteColumnMinWidth)}}prevTotal=total;while(total>availWidth&&shrinkLeeway){var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];var width=widths[i];if(!c.resizable||width<=c.minWidth||width<=absoluteColumnMinWidth){continue}var absMinWidth=Math.max(c.minWidth,absoluteColumnMinWidth);var shrinkSize=Math.floor(shrinkProportion*(width-absMinWidth))||1;shrinkSize=Math.min(shrinkSize,width-absMinWidth);total-=shrinkSize;shrinkLeeway-=shrinkSize;widths[i]-=shrinkSize}if(prevTotal==total){break}prevTotal=total}prevTotal=total;while(total<availWidth){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];if(!c.resizable||c.maxWidth<=c.width){continue}var growSize=Math.min(Math.floor(growProportion*c.width)-c.width,(c.maxWidth-c.width)||1000000)||1;total+=growSize;widths[i]+=growSize}if(prevTotal==total){break}prevTotal=total}var reRender=false;for(i=0;i<columns.length;i++){if(columns[i].rerenderOnResize&&columns[i].width!=widths[i]){reRender=true}columns[i].width=widths[i]}applyColumnHeaderWidths();updateCanvasWidth(true);if(reRender){invalidateAllRows();render()}}function applyColumnHeaderWidths(){if(!initialized){return}var h;for(var i=0,headers=$headers.children(),ii=headers.length;i<ii;i++){h=$(headers[i]);if(h.width()!==columns[i].width-headerColumnWidthDiff){h.width(columns[i].width-headerColumnWidthDiff)}}updateColumnCaches()}function applyColumnWidths(){var x=0,w,rule;for(var i=0;i<columns.length;i++){w=columns[i].width;rule=getColumnCssRules(i);rule.left.style.left=x+"px";rule.right.style.right=(((options.frozenColumn!=-1&&i>options.frozenColumn)?canvasWidthR:canvasWidthL)-x-w)+"px";if(options.frozenColumn==i){x=0}else{x+=columns[i].width}}}function setSortColumn(columnId,ascending){setSortColumns([{columnId:columnId,sortAsc:ascending}])}function setSortColumns(cols){sortColumns=cols;var headerColumnEls=$headers.children();headerColumnEls.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");$.each(sortColumns,function(i,col){if(col.sortAsc==null){col.sortAsc=true}var columnIndex=getColumnIndex(col.columnId);if(columnIndex!=null){headerColumnEls.eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(col.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,ranges){selectedRows=[];var hash={};for(var i=0;i<ranges.length;i++){for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){if(!hash[j]){selectedRows.push(j);hash[j]={}}for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++){if(canCellBeSelected(j,k)){hash[j][columns[k].id]=options.selectedCellCssClass}}}}setCellCssStyles(options.selectedCellCssClass,hash);trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[];columnPosRight=[];var x=0;for(var i=0,ii=columns.length;i<ii;i++){columnPosLeft[i]=x;columnPosRight[i]=x+columns[i].width;if(options.frozenColumn==i){x=0}else{x+=columns[i].width}}}function setColumns(columnDefinitions){columns=columnDefinitions;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}updateColumnCaches();if(initialized){setPaneVisibility();setOverflow();invalidateAllRows();createColumnHeaders();removeCssRules();createCssRules();resizeCanvas();updateCanvasWidth();applyColumnWidths();handleScroll()}}function getOptions(){return options}function setOptions(args){if(!getEditorLock().commitCurrentEdit()){return}makeActiveCellNormal();if(options.enableAddRow!==args.enableAddRow){invalidateRow(getDataLength())}options=$.extend(options,args);validateAndEnforceOptions();setFrozenOptions();setScroller();setColumns(columns);render()}function validateAndEnforceOptions(){if(options.autoHeight){options.leaveSpaceForNewRows=false}}function setData(newData,scrollToTop){data=newData;invalidateAllRows();updateRowCount();if(scrollToTop){scrollTo(0)}}function getData(){return data}function getDataLength(){if(data&&data.getLength){return data.getLength()}else{if(data){return data.length}else{return 0}}}function getDataItem(i){if(data&&data.getItem){return data.getItem(i)}else{if(data){return data[i]}else{return null}}}function scrollTo(y){y=Math.max(y,0);y=Math.min(y,th-$viewportScrollContainerY.height()+((viewportHasHScroll||options.frozenColumn>-1)?scrollbarDimensions.height:0));var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));offset=Math.round(page*cj);var newScrollTop=y-offset;if(offset!=oldOffset){var range=getVisibleRange(newScrollTop);cleanupRows(range);updateRowPositions()}if(prevScrollTop!=newScrollTop){vScrollDir=(prevScrollTop+oldOffset<newScrollTop+offset)?1:-1;lastRenderedScrollTop=(scrollTop=prevScrollTop=newScrollTop);if(options.frozenColumn>-1){$viewportTopL[0].scrollTop=newScrollTop}$viewportScrollContainerY[0].scrollTop=newScrollTop;trigger(self.onViewportChanged,{})}}function defaultFormatter(row,cell,value,columnDef,dataContext){if(value==null){return""}else{return value.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return(columnOverrides&&columnOverrides.formatter)||(rowMetadata&&rowMetadata.formatter)||column.formatter||(options.formatterFactory&&options.formatterFactory.getFormatter(column))||options.defaultFormatter}function getEditor(row,cell){var column=columns[cell];var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[column.id]&&columnMetadata[column.id].editor!==undefined){return columnMetadata[column.id].editor}if(columnMetadata&&columnMetadata[cell]&&columnMetadata[cell].editor!==undefined){return columnMetadata[cell].editor}return column.editor||(options.editorFactory&&options.editorFactory.getEditor(column))}function getDataItemValueForColumn(item,columnDef){if(options.dataItemColumnValueExtractor){return options.dataItemColumnValueExtractor(item,columnDef)}return item[columnDef.field]}function appendRowHtml(stringArrayL,stringArrayR,row,range){var d=getDataItem(row);var dataLoading=row<getDataLength()&&!d;var rowCss="slick-row"+(dataLoading?" loading":"")+(row===activeRow?" active":"")+(row%2==1?" odd":" even");var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(metadata&&metadata.cssClasses){rowCss+=" "+metadata.cssClasses}var rowHtml="<div class='ui-widget-content "+rowCss+"' style='top:"+(options.rowHeight*row-offset)+"px'>";stringArrayL.push(rowHtml);if(options.frozenColumn>-1){stringArrayR.push(rowHtml)}var colspan,m;for(var i=0,ii=columns.length;i<ii;i++){m=columns[i];colspan=1;if(metadata&&metadata.columns){var columnData=metadata.columns[m.id]||metadata.columns[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){if(columnPosLeft[i]>range.rightPx){break}if((options.frozenColumn>-1)&&(i>options.frozenColumn)){appendCellHtml(stringArrayR,row,i,colspan)}else{appendCellHtml(stringArrayL,row,i,colspan)}}else{if((options.frozenColumn>-1)&&(i<=options.frozenColumn)){appendCellHtml(stringArrayL,row,i,colspan)}}if(colspan>1){i+=(colspan-1)}}stringArrayL.push("</div>");if(options.frozenColumn>-1){stringArrayR.push("</div>")}}function appendCellHtml(stringArray,row,cell,colspan){var m=columns[cell];var d=getDataItem(row);var cellCss="slick-cell l"+cell+" r"+Math.min(columns.length-1,cell+colspan-1)+(m.cssClass?" "+m.cssClass:"");if(row===activeRow&&cell===activeCell){cellCss+=(" active")}for(var key in cellCssClasses){if(cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]){cellCss+=(" "+cellCssClasses[key][row][m.id])}}stringArray.push("<div class='"+cellCss+"'>");if(d){var value=getDataItemValueForColumn(d,m);stringArray.push(getFormatter(row,m)(row,cell,value,m,d))}stringArray.push("</div>");rowsCache[row].cellRenderQueue.push(cell);rowsCache[row].cellColSpans[cell]=colspan}function cleanupRows(rangeToKeep){for(var i in rowsCache){var removeFrozenRow=true;if(((i=parseInt(i,10))!==activeRow)&&(i<rangeToKeep.top||i>rangeToKeep.bottom)&&(removeFrozenRow)){removeRowFromCache(i)}}}function invalidate(){updateRowCount();invalidateAllRows();render()}function invalidateAllRows(){if(currentEditor){makeActiveCellNormal()}for(var row in rowsCache){removeRowFromCache(row)}}function removeRowFromCache(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}cacheEntry.rowNode[0].parentElement.removeChild(cacheEntry.rowNode[0]);if(cacheEntry.rowNode[1]){cacheEntry.rowNode[1].parentElement.removeChild(cacheEntry.rowNode[1])}delete rowsCache[row];delete postProcessedRows[row];renderedRows--;counter_rows_removed++}function invalidateRows(rows){var i,rl;if(!rows||!rows.length){return}vScrollDir=0;for(i=0,rl=rows.length;i<rl;i++){if(currentEditor&&activeRow===rows[i]){makeActiveCellNormal()}if(rowsCache[rows[i]]){removeRowFromCache(rows[i])}}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(!cellNode){return}var m=columns[cell],d=getDataItem(row);if(currentEditor&&activeRow===row&&activeCell===cell){currentEditor.loadValue(d)}else{cellNode.innerHTML=d?getFormatter(row,m)(row,cell,getDataItemValueForColumn(d,m),m,d):"";invalidatePostProcessingResults(row)}}function updateRow(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx],d=getDataItem(row),node=cacheEntry.cellNodesByColumnIdx[columnIdx][0];if(row===activeRow&&columnIdx===activeCell&&currentEditor){currentEditor.loadValue(d)}else{if(d){node.innerHTML=getFormatter(row,m)(row,columnIdx,getDataItemValueForColumn(d,m),m,d)}else{node.innerHTML=""}}}invalidatePostProcessingResults(row)}function getViewportHeight(){if(options.autoHeight){viewportH=options.rowHeight*(getDataLength()+(options.enableAddRow?1:0))+((options.frozenColumn==-1)?$headers.outerHeight():0)}else{viewportH=parseFloat($.css($container[0],"height",true))-parseFloat($.css($container[0],"paddingTop",true))-parseFloat($.css($container[0],"paddingBottom",true))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-topPanelH}numVisibleRows=Math.ceil(viewportH/options.rowHeight)}function getViewportWidth(){viewportW=parseFloat($.css($container[0],"width",true))}function resizeCanvas(){if(!initialized){return}paneTopH=0;viewportTopH=0;getViewportWidth();getViewportHeight();paneTopH=viewportH;paneTopH+=topPanelH;if(options.frozenColumn>-1&&options.autoHeight){paneTopH+=scrollbarDimensions.height}viewportTopH=paneTopH-topPanelH;if(options.autoHeight){if(options.frozenColumn>-1){$container.height(paneTopH+parseFloat($.css($headerScrollerL[0],"height")))}$paneTopL.css("position","relative")}$paneTopL.css({"top":$paneHeaderL.height(),"height":paneTopH});var paneBottomTop=$paneTopL.position().top+paneTopH;$viewportTopL.height(viewportTopH);if(options.frozenColumn>-1){$paneTopR.css({"top":$paneHeaderL.height(),"height":paneTopH});$viewportTopR.height(viewportTopH)}$viewportTopR.height(viewportTopH);if(options.forceFitColumns){autosizeColumns()}updateRowCount();handleScroll();render()}function updateRowCount(){if(!initialized){return}var oldH=$canvasTopL.height();numberOfRows=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var tempViewportH=$viewportScrollContainerY.height();var oldViewportHasVScroll=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&(numberOfRows*options.rowHeight>tempViewportH);var l=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache){if(i>=l){removeRowFromCache(i)}}th=Math.max(options.rowHeight*numberOfRows,tempViewportH-scrollbarDimensions.height);if(activeCellNode&&activeRow>l){resetActiveCell()}if(th<maxSupportedCssHeight){h=ph=th;n=1;cj=0}else{h=maxSupportedCssHeight;ph=h/100;n=Math.floor(th/ph);cj=(th-h)/(n-1)}if(h!==oldH){$canvasTopL.css("height",h);$canvasTopR.css("height",h);scrollTop=$viewportScrollContainerY[0].scrollTop}var oldScrollTopInRange=(scrollTop+offset<=th-tempViewportH);if(th==0||scrollTop==0){page=offset=0}else{if(oldScrollTopInRange){scrollTo(scrollTop+offset)}else{scrollTo(th-tempViewportH)}}if(h!=oldH&&options.autoHeight){resizeCanvas()}if(options.forceFitColumns&&oldViewportHasVScroll!=viewportHasVScroll){autosizeColumns()}updateCanvasWidth(false)}function getVisibleRange(viewportTop,viewportLeft){if(viewportTop==null){viewportTop=scrollTop}if(viewportLeft==null){viewportLeft=scrollLeft}return{top:Math.floor((viewportTop+offset)/options.rowHeight),bottom:Math.ceil((viewportTop+offset+viewportH)/options.rowHeight),leftPx:viewportLeft,rightPx:viewportLeft+viewportW}}function getRenderedRange(viewportTop,viewportLeft){var range=getVisibleRange(viewportTop,viewportLeft);var buffer=Math.round(viewportH/options.rowHeight);var minBuffer=3;if(vScrollDir==-1){range.top-=buffer;range.bottom+=minBuffer}else{if(vScrollDir==1){range.top-=minBuffer;range.bottom+=buffer}else{range.top-=minBuffer;range.bottom+=minBuffer}}range.top=Math.max(0,range.top);range.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,range.bottom);range.leftPx-=viewportW;range.rightPx+=viewportW;range.leftPx=Math.max(0,range.leftPx);range.rightPx=Math.min(canvasWidth,range.rightPx);return range}function ensureCellNodesInRowsCache(row){var cacheEntry=rowsCache[row];if(cacheEntry){if(cacheEntry.cellRenderQueue.length){var $lastNode=cacheEntry.rowNode.children().last();while(cacheEntry.cellRenderQueue.length){var columnIdx=cacheEntry.cellRenderQueue.pop();cacheEntry.cellNodesByColumnIdx[columnIdx]=$lastNode;$lastNode=$lastNode.prev();if($lastNode.length==0){$lastNode=$(cacheEntry.rowNode[0]).children().last()}}}}}function cleanUpCells(range,row){var totalCellsRemoved=0;var cacheEntry=rowsCache[row];var cellsToRemove=[];for(var i in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(i)){continue}i=i|0;if(i<=options.frozenColumn){continue}var colspan=cacheEntry.cellColSpans[i];if(columnPosLeft[i]>range.rightPx||columnPosRight[Math.min(columns.length-1,i+colspan-1)]<range.leftPx){if(!(row==activeRow&&i==activeCell)){cellsToRemove.push(i)}}}var cellToRemove;while((cellToRemove=cellsToRemove.pop())!=null){cacheEntry.cellNodesByColumnIdx[cellToRemove][0].parentElement.removeChild(cacheEntry.cellNodesByColumnIdx[cellToRemove][0]);delete cacheEntry.cellColSpans[cellToRemove];delete cacheEntry.cellNodesByColumnIdx[cellToRemove];if(postProcessedRows[row]){delete postProcessedRows[row][cellToRemove]}totalCellsRemoved++}}function cleanUpAndRenderCells(range){var cacheEntry;var stringArray=[];var processedRows=[];var cellsAdded;var totalCellsAdded=0;var colspan;for(var row=range.top;row<=range.bottom;row++){cacheEntry=rowsCache[row];if(!cacheEntry){continue}ensureCellNodesInRowsCache(row);cleanUpCells(range,row);cellsAdded=0;var metadata=data.getItemMetadata&&data.getItemMetadata(row);metadata=metadata&&metadata.columns;for(var i=0,ii=columns.length;i<ii;i++){if(columnPosLeft[i]>range.rightPx){break}if((colspan=cacheEntry.cellColSpans[i])!=null){i+=(colspan>1?colspan-1:0);continue}colspan=1;if(metadata){var columnData=metadata[columns[i].id]||metadata[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){appendCellHtml(stringArray,row,i,colspan);cellsAdded++}i+=(colspan>1?colspan-1:0)}if(cellsAdded){totalCellsAdded+=cellsAdded;processedRows.push(row)}}if(!stringArray.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");var processedRow;var $node;while((processedRow=processedRows.pop())!=null){cacheEntry=rowsCache[processedRow];var columnIdx;while((columnIdx=cacheEntry.cellRenderQueue.pop())!=null){$node=$(x).children().last();if((options.frozenColumn>-1)&&(columnIdx>options.frozenColumn)){$(cacheEntry.rowNode[1]).append($node)}else{$(cacheEntry.rowNode[0]).append($node)}cacheEntry.cellNodesByColumnIdx[columnIdx]=$node}}}function renderRows(range){var stringArrayL=[],stringArrayR=[],rows=[],needToReselectCell=false;for(var i=range.top;i<=range.bottom;i++){if(rowsCache[i]){continue}renderedRows++;rows.push(i);rowsCache[i]={"rowNode":null,"cellColSpans":[],"cellNodesByColumnIdx":[],"cellRenderQueue":[]};appendRowHtml(stringArrayL,stringArrayR,i,range);if(activeCellNode&&activeRow===i){needToReselectCell=true}counter_rows_rendered++}if(!rows.length){return}var x=document.createElement("div"),xRight=document.createElement("div");x.innerHTML=stringArrayL.join("");xRight.innerHTML=stringArrayR.join("");for(var i=0,ii=rows.length;i<ii;i++){if(options.frozenColumn>-1){rowsCache[rows[i]].rowNode=$().add($(x.firstChild).appendTo($canvasTopL)).add($(xRight.firstChild).appendTo($canvasTopR))}else{rowsCache[rows[i]].rowNode=$().add($(x.firstChild).appendTo($canvasTopL))}}if(needToReselectCell){activeCellNode=getCellNode(activeRow,activeCell)}}function startPostProcessing(){if(!options.enableAsyncPostRender){return}clearTimeout(h_postrender);h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay)}function invalidatePostProcessingResults(row){delete postProcessedRows[row];postProcessFromRow=Math.min(postProcessFromRow,row);postProcessToRow=Math.max(postProcessToRow,row);startPostProcessing()}function updateRowPositions(){for(var row in rowsCache){rowsCache[row].rowNode.css("top",(row*options.rowHeight-offset)+"px")}}function render(){if(!initialized){return}var visible=getVisibleRange();var rendered=getRenderedRange();cleanupRows(rendered);if(lastRenderedScrollLeft!=scrollLeft){cleanUpAndRenderCells(rendered)}renderRows(rendered);postProcessFromRow=visible.top;postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,visible.bottom);startPostProcessing();lastRenderedScrollTop=scrollTop;lastRenderedScrollLeft=scrollLeft;h_render=null}function handleMouseWheel(event,delta,deltaX,deltaY){scrollTop=$viewportScrollContainerY[0].scrollTop-(deltaY*options.rowHeight);scrollLeft=$viewportScrollContainerX[0].scrollLeft+(deltaX*10);_handleScroll();event.preventDefault()}function handleScroll(){scrollTop=$viewportScrollContainerY[0].scrollTop;scrollLeft=$viewportScrollContainerX[0].scrollLeft;_handleScroll()}function _handleScroll(){var maxScrollDistanceY=$viewportScrollContainerY[0].scrollHeight-$viewportScrollContainerY[0].clientHeight;var maxScrollDistanceX=$viewportScrollContainerY[0].scrollWidth-$viewportScrollContainerY[0].clientWidth;if(scrollTop>maxScrollDistanceY){scrollTop=maxScrollDistanceY}if(scrollLeft>maxScrollDistanceX){scrollLeft=maxScrollDistanceX}var vScrollDist=Math.abs(scrollTop-prevScrollTop);var hScrollDist=Math.abs(scrollLeft-prevScrollLeft);if(hScrollDist){prevScrollLeft=scrollLeft;$headerScrollContainer[0].scrollLeft=scrollLeft;$viewportScrollContainerX[0].scrollLeft=scrollLeft}if(vScrollDist){vScrollDir=prevScrollTop<scrollTop?1:-1;prevScrollTop=scrollTop;$viewportScrollContainerY[0].scrollTop=scrollTop;if(options.frozenColumn>-1){$viewportTopL[0].scrollTop=scrollTop}if(vScrollDist<viewportH){scrollTo(scrollTop+offset)}else{var oldOffset=offset;if(h==viewportH){page=0}else{page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph)))}offset=Math.round(page*cj);if(oldOffset!=offset){invalidateAllRows()}}}if(hScrollDist||vScrollDist){if(h_render){clearTimeout(h_render)}if(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20){if(options.forceSyncScrolling||(Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW)){render()}else{h_render=setTimeout(render,50)}trigger(self.onViewportChanged,{})}}trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){while(postProcessFromRow<=postProcessToRow){var row=(vScrollDir>=0)?postProcessFromRow++:postProcessToRow--;var cacheEntry=rowsCache[row];if(!cacheEntry||row>=getDataLength()){continue}if(!postProcessedRows[row]){postProcessedRows[row]={}}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx];if(m.asyncPostRender&&!postProcessedRows[row][columnIdx]){var node=cacheEntry.cellNodesByColumnIdx[columnIdx];if(node){m.asyncPostRender(node,row,getDataItem(row),m)}postProcessedRows[row][columnIdx]=true}}h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}function updateCellCssStylesOnRenderedRows(addedHash,removedHash){var node,columnId,addedRowHash,removedRowHash;for(var row in rowsCache){removedRowHash=removedHash&&removedHash[row];addedRowHash=addedHash&&addedHash[row];if(removedRowHash){for(columnId in removedRowHash){if(!addedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).removeClass(removedRowHash[columnId])}}}}if(addedRowHash){for(columnId in addedRowHash){if(!removedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).addClass(addedRowHash[columnId])}}}}}}function addCellCssStyles(key,hash){if(cellCssClasses[key]){throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists."}cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,null);trigger(self.onCellCssStylesChanged,{"key":key,"hash":hash})}function removeCellCssStyles(key){if(!cellCssClasses[key]){return}updateCellCssStylesOnRenderedRows(null,cellCssClasses[key]);delete cellCssClasses[key];trigger(self.onCellCssStylesChanged,{"key":key,"hash":null})}function setCellCssStyles(key,hash){var prevHash=cellCssClasses[key];cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,prevHash);trigger(self.onCellCssStylesChanged,{"key":key,"hash":hash})}function getCellCssStyles(key){return cellCssClasses[key]}function flashCell(row,cell,speed){speed=speed||100;if(rowsCache[row]){var $cell=$(getCellNode(row,cell));function toggleCellClass(times){if(!times){return}setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue();toggleCellClass(times-1)})},speed)}toggleCellClass(4)}}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}retval=trigger(self.onDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}var retval=trigger(self.onDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var handled=e.isImmediatePropagationStopped();if(!handled){if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==27){if(!getEditorLock().isActive()){return}cancelEditAndSetFocus()}else{if(e.which==37){handled=navigateLeft()}else{if(e.which==39){handled=navigateRight()}else{if(e.which==38){handled=navigateUp()}else{if(e.which==40){handled=navigateDown()}else{if(e.which==9){handled=navigateNext()}else{if(e.which==13){if(options.editable){if(currentEditor){if(activeRow===getDataLength()){navigateDown()}else{commitEditAndSetFocus()}}else{if(getEditorLock().commitCurrentEdit()){makeActiveCellEditable()}}}handled=true}}}}}}}}else{if(e.which==9&&e.shiftKey&&!e.ctrlKey&&!e.altKey){handled=navigatePrev()}}}if(handled){e.stopPropagation();e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}}function handleClick(e){if(!currentEditor){if(e.target!=document.activeElement){setFocus()}}var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if((activeCell!=cell.cell||activeRow!=cell.row)&&canCellBeActive(cell.row,cell.cell)){if(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()){setActiveCellInternal(getCellNode(cell.row,cell.cell),(cell.row===getDataLength())||options.autoEdit)}}}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if($cell.length===0){return}if(activeCellNode===$cell[0]&&currentEditor!==null){return}var activeCell;if(getSelectedRows().length<2){var c=getCellFromEvent(e);setActiveCell(c.row,c.cell);activeCell={row:c.row,cell:c.cell}}trigger(self.onContextMenu,activeCell,e)}function handleDblClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onDblClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(options.editable){gotoCell(cell.row,cell.cell,true)}}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{"column":$(this).data("column")},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{"column":$(this).data("column")},e)}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");trigger(self.onHeaderContextMenu,{column:column},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(column){trigger(self.onHeaderClick,{column:column},e)}}function handleCanvasMouseLeave(e){if($(e.currentTarget).is("div.grid-canvas")&&$(e.target).is("div.slick-cell")&&!$.contains(e.currentTarget,e.relatedTarget)){if(e.target.type!="img"&&!$(e.relatedTarget).hasClass("ui-datepicker")&&!$(e.relatedTarget).hasClass("esLi")){getEditorLock().commitCurrentEdit();trigger(self.onCanvasMouseLeave,{},e)}}}function handleRowMouseEnter(e){var row=getRowFromNode($(e.currentTarget));trigger(self.onRowMouseEnter,{row:row},e)}function handleRowMouseLeave(e){var row=getRowFromNode($(e.currentTarget));trigger(self.onRowMouseLeave,{row:row},e)}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(row,cell){return !(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){var row=Math.floor((y+offset)/options.rowHeight);var cell=0;var w=0;for(var i=0;i<columns.length&&w<x;i++){w+=columns[i].width;cell++}if(cell<0){cell=0}return{row:row,cell:cell-1}}function getCellFromNode(cellNode){var cls=/l\d+/.exec(cellNode.className);if(!cls){throw"getCellFromNode: cannot get cell - "+cellNode.className}return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getRowFromNode(rowNode){for(var row in rowsCache){if(rowsCache[row].rowNode[0]===rowNode[0]){return row|0}}return null}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length){return null}var c=$cell.parents(".grid-canvas").offset();var rowOffset=0;var isBottom=$cell.parents(".grid-canvas-bottom").length;var row=getCellFromPoint(e.clientX-c.left,e.clientY-c.top+rowOffset+$(document).scrollTop()).row;var cell=getCellFromNode($cell[0]);if(row==null||cell==null){return null}else{return{"row":row,"cell":cell}}}function getCellNodeBox(row,cell){if(!cellExists(row,cell)){return null}var y1=row*options.rowHeight-offset;var y2=y1+options.rowHeight-1;var x1=0;for(var i=0;i<cell;i++){x1+=columns[i].width;if(options.frozenColumn==i){x1=0}}var x2=x1+columns[cell].width;return{top:y1,left:x1,bottom:y2,right:x2}}function resetActiveCell(){setActiveCellInternal(null,false)}function setFocus(){if(tabbingDirection==-1){$focusSink[0].focus()}else{$focusSink2[0].focus()}}function scrollCellIntoView(row,cell){if(cell<=options.frozenColumn){return}var colspan=getColspan(row,cell);var left=columnPosLeft[cell],right=columnPosRight[cell+(colspan>1?colspan-1:0)],scrollRight=scrollLeft+$viewportScrollContainerX.width();if(left<scrollLeft){$viewportScrollContainerX.scrollLeft(left);handleScroll();render()}else{if(right>scrollRight){$viewportScrollContainerX.scrollLeft(Math.min(left,right-$viewportScrollContainerX[0].clientWidth));handleScroll();render()}}}function setActiveCellInternal(newCell,editMode){if(activeCellNode!==null){makeActiveCellNormal();$(activeCellNode).removeClass("active");if(rowsCache[activeRow]){$(rowsCache[activeRow].rowNode).removeClass("active")}}var activeCellChanged=(activeCellNode!==newCell);activeCellNode=newCell;if(activeCellNode!=null){var $activeCellNode=$(activeCellNode);var $activeCellOffset=$activeCellNode.offset();var rowOffset=Math.floor($activeCellNode.parents(".grid-canvas").offset().top);var isBottom=$activeCellNode.parents(".grid-canvas-bottom").length;cell=getCellFromPoint($activeCellOffset.left,Math.ceil($activeCellOffset.top)-rowOffset);activeRow=cell.row;activeCell=activePosX=activeCell=activePosX=getCellFromNode(activeCellNode[0]);$activeCellNode.addClass("active");if(options.editable&&editMode&&isCellPotentiallyEditable(activeRow,activeCell)){clearTimeout(h_editorLoader);if(options.asyncEditorLoading){h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay)}else{makeActiveCellEditable()}}}else{activeRow=activeCell=null}if(activeCellChanged){setTimeout(scrollActiveCellIntoView,50);trigger(self.onActiveCellChanged,getActiveCell())}}function clearTextSelection(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var sel=window.getSelection();if(sel&&sel.removeAllRanges){sel.removeAllRanges()}}}}function isCellPotentiallyEditable(row,cell){if(row<getDataLength()&&!getDataItem(row)){return false}if(columns[cell].cannotTriggerInsert&&row>=getDataLength()){return false}if(!getEditor(row,cell)){return false}return true}function makeActiveCellNormal(){if(!currentEditor){return}trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor});currentEditor.destroy();currentEditor=null;if(activeCellNode){var d=getDataItem(activeRow);$(activeCellNode).removeClass("editable invalid");if(d){var column=columns[activeCell];var formatter=getFormatter(activeRow,column);activeCellNode[0].innerHTML=formatter(activeRow,activeCell,getDataItemValueForColumn(d,column),column,getDataItem(activeRow));invalidatePostProcessingResults(activeRow)}}if(navigator.userAgent.toLowerCase().match(/msie/)){clearTextSelection()}getEditorLock().deactivate(editController)}function makeActiveCellEditable(editor){if(!activeCellNode){return}if(!options.editable){throw"Grid : makeActiveCellEditable : should never get called when options.editable is false"}clearTimeout(h_editorLoader);if(!isCellPotentiallyEditable(activeRow,activeCell)){return}var columnDef=columns[activeCell];var item=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef})===false){setFocus();return}getEditorLock().activate(editController);$(activeCellNode).addClass("editable");if(!editor){activeCellNode[0].innerHTML=""}currentEditor=new (editor||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode[0]),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus});if(item){currentEditor.loadValue(item)}serializedEditorValue=currentEditor.serializeValue();if(currentEditor.position){handleActiveCellPositionChange()}}function commitEditAndSetFocus(){if(getEditorLock().commitCurrentEdit()){setFocus();if(options.autoEdit){navigateDown()}}}function cancelEditAndSetFocus(){if(getEditorLock().cancelCurrentEdit()){setFocus()}}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:true};box.bottom=box.top+box.height;box.right=box.left+box.width;var offsetParent=elem.offsetParent;while((elem=elem.parentNode)!=document.body){if(box.visible&&elem.scrollHeight!=elem.offsetHeight&&$(elem).css("overflowY")!="visible"){box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight}if(box.visible&&elem.scrollWidth!=elem.offsetWidth&&$(elem).css("overflowX")!="visible"){box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth}box.left-=elem.scrollLeft;box.top-=elem.scrollTop;if(elem===offsetParent){box.left+=elem.offsetLeft;box.top+=elem.offsetTop;offsetParent=elem.offsetParent}box.bottom=box.top+box.height;box.right=box.left+box.width}return box}function getActiveCellPosition(){return absBox(activeCellNode[0])}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(!activeCellNode){return}trigger(self.onActiveCellPositionChanged,{});if(currentEditor){var cellBox=getActiveCellPosition();if(currentEditor.show&&currentEditor.hide){if(!cellBox.visible){currentEditor.hide()}else{currentEditor.show()}}if(currentEditor.position){currentEditor.position(cellBox)}}}function getCellEditor(){return currentEditor}function getActiveCell(){if(!activeCellNode){return null}else{return{row:activeRow,cell:activeCell}}}function getActiveCellNode(){return activeCellNode}function scrollActiveCellIntoView(){if(activeRow!=null&&activeCell!=null){scrollCellIntoView(activeRow,activeCell)}}function scrollRowIntoView(row,doPaging){var viewportScrollH=$viewportScrollContainerY.height();var rowAtTop=row*options.rowHeight;var rowAtBottom=(row+1)*options.rowHeight-viewportScrollH+(viewportHasHScroll?scrollbarDimensions.height:0);if((row+1)*options.rowHeight>scrollTop+viewportScrollH+offset){scrollTo(doPaging?rowAtTop:rowAtBottom);render()}else{if(row*options.rowHeight<scrollTop+offset){scrollTo(doPaging?rowAtBottom:rowAtTop);render()}}}function scrollRowToTop(row){scrollTo(row*options.rowHeight);render()}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns){return 1}var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell];var colspan=(columnData&&columnData.colspan);if(colspan==="*"){colspan=columns.length-cell}else{colspan=colspan||1}return(colspan||1)}function findFirstFocusableCell(row){var cell=0;while(cell<columns.length){if(canCellBeActive(row,cell)){return cell}cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){var cell=0;var lastFocusableCell=null;while(cell<columns.length){if(canCellBeActive(row,cell)){lastFocusableCell=cell}cell+=getColspan(row,cell)}return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length){return null}do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));if(cell<columns.length){return{"row":row,"cell":cell,"posX":cell}}return null}function gotoLeft(row,cell,posX){if(cell<=0){return null}var firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell===null||firstFocusableCell>=cell){return null}var prev={"row":row,"cell":firstFocusableCell,"posX":firstFocusableCell};var pos;while(true){pos=gotoRight(prev.row,prev.cell,prev.posX);if(!pos){return null}if(pos.cell>=cell){return prev}prev=pos}}function gotoDown(row,cell,posX){var prevCell;while(true){if(++row>=getDataLength()+(options.enableAddRow?1:0)){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{"row":row,"cell":prevCell,"posX":posX}}}}function gotoUp(row,cell,posX){var prevCell;while(true){if(--row<0){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{"row":row,"cell":prevCell,"posX":posX}}}}function gotoNext(row,cell,posX){if(row==null&&cell==null){row=cell=posX=0;if(canCellBeActive(row,cell)){return{"row":row,"cell":cell,"posX":cell}}}var pos=gotoRight(row,cell,posX);if(pos){return pos}var firstFocusableCell=null;while(++row<getDataLength()+(options.enableAddRow?1:0)){firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell!==null){return{"row":row,"cell":firstFocusableCell,"posX":firstFocusableCell}}}return null}function gotoPrev(row,cell,posX){if(row==null&&cell==null){row=getDataLength()+(options.enableAddRow?1:0)-1;cell=posX=columns.length-1;if(canCellBeActive(row,cell)){return{"row":row,"cell":cell,"posX":cell}}}var pos;var lastSelectableCell;while(!pos){pos=gotoLeft(row,cell,posX);if(pos){break}if(--row<0){return null}cell=0;lastSelectableCell=findLastFocusableCell(row);if(lastSelectableCell!==null){pos={"row":row,"cell":lastSelectableCell,"posX":lastSelectableCell}}}return pos}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(dir){if(!options.enableCellNavigation){return false}if(!activeCellNode&&dir!="prev"&&dir!="next"){return false}if(!getEditorLock().commitCurrentEdit()){return true}setFocus();var tabbingDirections={"up":-1,"down":1,"left":-1,"right":1,"prev":-1,"next":1};tabbingDirection=tabbingDirections[dir];var stepFunctions={"up":gotoUp,"down":gotoDown,"left":gotoLeft,"right":gotoRight,"prev":gotoPrev,"next":gotoNext};var stepFn=stepFunctions[dir];var pos=stepFn(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=(pos.row==getDataLength());scrollRowIntoView(pos.row,!isAddNewRow);scrollCellIntoView(pos.row,pos.cell);setActiveCellInternal(getCellNode(pos.row,pos.cell),isAddNewRow||options.autoEdit);activePosX=pos.posX;return true}else{setActiveCellInternal(getCellNode(activeRow,activeCell),(activeRow==getDataLength())||options.autoEdit);return false}}function getCellNode(row,cell){if(rowsCache[row]){ensureCellNodesInRowsCache(row);return rowsCache[row].cellNodesByColumnIdx[cell]}return null}function setActiveCell(row,cell){if(!initialized){return}if(row>getDataLength()||row<0||cell>=columns.length||cell<0){return}if(!options.enableCellNavigation){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);setActiveCellInternal(getCellNode(row,cell),false)}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLength()+(options.enableAddRow?1:0)||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.focusable==="boolean"){return rowMetadata.focusable}var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[columns[cell].id]&&typeof columnMetadata[columns[cell].id].focusable==="boolean"){return columnMetadata[columns[cell].id].focusable}if(columnMetadata&&columnMetadata[cell]&&typeof columnMetadata[cell].focusable==="boolean"){return columnMetadata[cell].focusable}if(typeof columns[cell].focusable==="boolean"){return columns[cell].focusable}return true}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.selectable==="boolean"){return rowMetadata.selectable}var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);if(columnMetadata&&typeof columnMetadata.selectable==="boolean"){return columnMetadata.selectable}if(typeof columns[cell].selectable==="boolean"){return columns[cell].selectable}return true}function gotoCell(row,cell,forceEdit){if(!initialized){return}if(!canCellBeActive(row,cell)){return}if(!getEditorLock().commitCurrentEdit()){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);var newCell=getCellNode(row,cell);setActiveCellInternal(newCell,forceEdit||(row===getDataLength())||options.autoEdit);if(!currentEditor){setFocus()}}function commitCurrentEdit(){var item=getDataItem(activeRow);var column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue);updateRow(this.row)},undo:function(){this.editor.applyValue(item,this.prevSerializedValue);updateRow(this.row)}};if(options.editCommandHandler){makeActiveCellNormal();options.editCommandHandler(item,column,editCommand)}else{editCommand.execute();makeActiveCellNormal()}trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item})}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue());makeActiveCellNormal();trigger(self.onAddNewRow,{item:newItem,column:column})}return !getEditorLock().isActive()}else{$(activeCellNode).addClass("invalid");$(activeCellNode).stop(true,true).effect("highlight",{color:"red"},300);trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column});currentEditor.focus();return false}}makeActiveCellNormal()}return true}function cancelCurrentEdit(){makeActiveCellNormal();return true}function rowsToRanges(rows){var ranges=[];var lastCell=columns.length-1;for(var i=0;i<rows.length;i++){ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell))}return ranges}function getSelectedRows(){if(!selectionModel){throw"Selection model is not set"}return selectedRows}function setSelectedRows(rows){if(!selectionModel){throw"Selection model is not set"}selectionModel.setSelectedRanges(rowsToRanges(rows))}function getSelectedDataItem(){if(!selectionModel){throw"Selection model is not set"}if(data.getItemByIdx){return data.getItemByIdx(selectedRows[0])}else{return getDataItem(selectedRows[0])}}function getSelectedDataItems(){if(!selectionModel){throw"Selection model is not set"}var items;if(data.getItemByIdx){items=selectedRows.map(function(x){return data.getItemByIdx(x)})}else{items=jQuery.map(selectedRows,function(x){return getDataItem(x)})}return items}function getCheckedDataItem(){if(!selectionModel){throw"Selection model is not set"}var item;if(data.getItems){var rows=data.getItems();for(var i=0;i<rows.length;i++){if(rows[i].checked==true){item=rows[i];break}}}else{for(var i=0;i<data.length;i++){if(data[i].checked==true){item=data[i];break}}}return item}function getCheckedDataItems(){if(!selectionModel){throw"Selection model is not set"}var items;if(data.getItems){var rows=data.getItems();items=jQuery.grep(rows,function(x){return x.checked==true})}else{items=jQuery.grep(data,function(x){return x.checked==true})}return items}this.debug=function(){var s="";s+=("\ncounter_rows_rendered:  "+counter_rows_rendered);s+=("\ncounter_rows_removed:  "+counter_rows_removed);s+=("\nrenderedRows:  "+renderedRows);s+=("\nnumVisibleRows:  "+numVisibleRows);s+=("\nmaxSupportedCssHeight:  "+maxSupportedCssHeight);s+=("\nn(umber of pages):  "+n);s+=("\n(current) page:  "+page);s+=("\npage height (ph):  "+ph);s+=("\nvScrollDir:  "+vScrollDir);alert(s)};this.eval=function(expr){return eval(expr)};$.extend(this,{"slickGridVersion":"2.1","onScroll":new Slick.Event(),"onSort":new Slick.Event(),"onHeaderMouseEnter":new Slick.Event(),"onHeaderMouseLeave":new Slick.Event(),"onHeaderContextMenu":new Slick.Event(),"onHeaderClick":new Slick.Event(),"onHeaderCellRendered":new Slick.Event(),"onBeforeHeaderCellDestroy":new Slick.Event(),"onHeaderRowCellRendered":new Slick.Event(),"onBeforeHeaderRowCellDestroy":new Slick.Event(),"onCanvasMouseLeave":new Slick.Event(),"onRowMouseEnter":new Slick.Event(),"onRowMouseLeave":new Slick.Event(),"onMouseEnter":new Slick.Event(),"onMouseLeave":new Slick.Event(),"onClick":new Slick.Event(),"onDblClick":new Slick.Event(),"onContextMenu":new Slick.Event(),"onKeyDown":new Slick.Event(),"onAddNewRow":new Slick.Event(),"onValidationError":new Slick.Event(),"onViewportChanged":new Slick.Event(),"onColumnsReordered":new Slick.Event(),"onColumnsResized":new Slick.Event(),"onCellChange":new Slick.Event(),"onBeforeEditCell":new Slick.Event(),"onBeforeCellEditorDestroy":new Slick.Event(),"onBeforeDestroy":new Slick.Event(),"onActiveCellChanged":new Slick.Event(),"onActiveCellPositionChanged":new Slick.Event(),"onDragInit":new Slick.Event(),"onDragStart":new Slick.Event(),"onDrag":new Slick.Event(),"onDragEnd":new Slick.Event(),"onSelectedRowsChanged":new Slick.Event(),"onCellCssStylesChanged":new Slick.Event(),"registerPlugin":registerPlugin,"unregisterPlugin":unregisterPlugin,"getColumns":getColumns,"setColumns":setColumns,"getColumnIndex":getColumnIndex,"updateColumnHeader":updateColumnHeader,"setSortColumn":setSortColumn,"setSortColumns":setSortColumns,"getSortColumns":getSortColumns,"autosizeColumns":autosizeColumns,"getOptions":getOptions,"setOptions":setOptions,"getData":getData,"getDataLength":getDataLength,"getDataItem":getDataItem,"setData":setData,"getSelectionModel":getSelectionModel,"setSelectionModel":setSelectionModel,"getSelectedRows":getSelectedRows,"setSelectedRows":setSelectedRows,"getSelectedDataItem":getSelectedDataItem,"getSelectedDataItems":getSelectedDataItems,"getCheckedDataItem":getCheckedDataItem,"getCheckedDataItems":getCheckedDataItems,"getVisibleColumns":getVisibleColumns,"getGridId":getGridId,"render":render,"invalidate":invalidate,"invalidateRow":invalidateRow,"invalidateRows":invalidateRows,"invalidateAllRows":invalidateAllRows,"updateCell":updateCell,"updateRow":updateRow,"getViewport":getVisibleRange,"getRenderedRange":getRenderedRange,"resizeCanvas":resizeCanvas,"updateRowCount":updateRowCount,"scrollRowIntoView":scrollRowIntoView,"scrollRowToTop":scrollRowToTop,"scrollCellIntoView":scrollCellIntoView,"getCanvasNode":getCanvasNode,"getCanvases":getCanvases,"getActiveCanvasNode":getActiveCanvasNode,"setActiveCanvasNode":setActiveCanvasNode,"getViewportNode":getViewportNode,"getActiveViewportNode":getActiveViewportNode,"setActiveViewportNode":setActiveViewportNode,"focus":setFocus,"getCellFromPoint":getCellFromPoint,"getCellFromEvent":getCellFromEvent,"getActiveCell":getActiveCell,"setActiveCell":setActiveCell,"getActiveCellNode":getActiveCellNode,"getActiveCellPosition":getActiveCellPosition,"resetActiveCell":resetActiveCell,"editActiveCell":makeActiveCellEditable,"getCellEditor":getCellEditor,"getCellNode":getCellNode,"getCellNodeBox":getCellNodeBox,"canCellBeSelected":canCellBeSelected,"canCellBeActive":canCellBeActive,"navigatePrev":navigatePrev,"navigateNext":navigateNext,"navigateUp":navigateUp,"navigateDown":navigateDown,"navigateLeft":navigateLeft,"navigateRight":navigateRight,"gotoCell":gotoCell,"getGridPosition":getGridPosition,"flashCell":flashCell,"addCellCssStyles":addCellCssStyles,"setCellCssStyles":setCellCssStyles,"removeCellCssStyles":removeCellCssStyles,"getCellCssStyles":getCellCssStyles,"init":finishInitialization,"destroy":destroy,"getEditorLock":getEditorLock,"getEditController":getEditController});init()}}(jQuery));(function(D){D.extend(true,window,{Slick:{Data:{DataView:F,Aggregators:{Avg:B,Min:A,Max:E,Sum:C}}}});function F(S){var AF=this;var Ag={groupItemMetadataProvider:null,inlineFilters:false};var h="id";var AB=[];var AE=[];var I={};var Ab=null;var s=null;var b=null;var U=false;var y=true;var p;var j;var AG={};var Av={};var Am;var r=[];var As;var x;var J=[];var T;var Ah;var q;var Ay;var Ai=[];var AQ={};var Az;var c=false;var AM;var d=0;var Q=0;var An=0;var Ar=new Slick.Event();var Ad=new Slick.Event();var AO=new Slick.Event();S=D.extend(true,{},Ag,S);function g(){U=true}function K(){U=false;n()}function Ak(AS){AG=AS}function Au(AS){Am=AS}function L(AS){AS=AS||0;var AU;for(var AT=AS,AV=AB.length;AT<AV;AT++){AU=AB[AT][h];if(AU===undefined){throw"Each data element must implement a unique 'id' property"}I[AU]=AT}}function Y(){var AT;for(var AS=0,AU=AB.length;AS<AU;AS++){AT=AB[AS][h];if(AT===undefined||I[AT]!==AS){throw"Each data element must implement a unique 'id' property"}}}function Ac(){return AB}function AC(AT,AS){if(AS!==undefined){h=AS}AB=r=AT;I={};L();Y();n()}function AL(AS){if(AS.pageSize!=undefined){d=AS.pageSize;Q=d?Math.min(Q,Math.max(0,Math.ceil(An/d)-1)):0}if(AS.pageNum!=undefined){Q=Math.min(AS.pageNum,Math.max(0,Math.ceil(An/d)-1))}AO.notify(t(),null,AF);n()}function t(){var AS=d?Math.max(1,Math.ceil(An/d)):1;return{pageSize:d,pageNum:Q,totalRows:An,totalPages:AS}}function z(AS,AT){y=AT;j=AS;p=null;if(AT===false){AB.reverse()}AB.sort(AS);if(AT===false){AB.reverse()}I={};L();n()}function At(AU,AT){y=AT;p=AU;j=null;var AS=Object.prototype.toString;Object.prototype.toString=(typeof AU=="function")?AU:function(){return this[AU]};if(AT===false){AB.reverse()}AB.sort();Object.prototype.toString=AS;if(AT===false){AB.reverse()}I={};L();n()}function Aj(){if(j){z(j,y)}else{if(p){At(p,y)}}}function W(AS){s=AS;if(S.inlineFilters){As=u();x=Ao()}n()}function Aq(AU,AS,AT){if(!S.groupItemMetadataProvider){S.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider()}T=AU;Ah=typeof T==="function";q=AS;Ay=AT;AQ={};Ai=[];n()}function AP(AU,AS){Az=AU;c=(AS!==undefined)?AS:c;AM=[];var AT=Az.length;while(AT--){AM[AT]=a(Az[AT])}n()}function AR(AS){return AB[AS]}function e(AS){return I[AS]}function AD(){if(!Ab){Ab={};for(var AS=0,AT=AE.length;AS<AT;AS++){Ab[AE[AS][h]]=AS}}}function M(AS){AD();return Ab[AS]}function Aa(AS){return AB[I[AS]]}function Al(AT){var AV=[];AD();for(var AS=0;AS<AT.length;AS++){var AU=Ab[AT[AS]];if(AU!=null){AV[AV.length]=AU}}return AV}function H(AU){var AS=[];for(var AT=0;AT<AU.length;AT++){if(AU[AT]<AE.length){AS[AS.length]=AE[AU[AT]][h]}}return AS}function Af(AT,AS){if(I[AT]===undefined||AT!==AS[h]){throw"Invalid or non-matching id"}AB[I[AT]]=AS;if(!b){b={}}b[AT]=true;n()}function AI(AS,AT){AB.splice(AS,0,AT);L(AS);n()}function w(AS){AB.push(AS);L(AB.length-1);n()}function o(AS){var AT=I[AS];if(AT===undefined){throw"Invalid id"}delete I[AS];AB.splice(AT,1);L(AT);n()}function AN(){return AE.length}function AJ(){return AE}function V(AS){return AE[AS]}function l(AS){var AT=AE[AS];if(AT===undefined){return null}if(AT.__group){return S.groupItemMetadataProvider.getGroupRowMetadata(AT)}if(AT.__groupTotals){return S.groupItemMetadataProvider.getTotalsRowMetadata(AT)}return null}function X(AS){AQ[AS]=true;n()}function Aw(AS){delete AQ[AS];n()}function AA(){return Ai}function N(AT){var AY;var AU;var AW=[];var AV=[];var AX;for(var AS=0,AZ=AT.length;AS<AZ;AS++){AX=AT[AS];AU=(Ah)?T(AX):AX[T];AU=AU||0;AY=AV[AU];if(!AY){AY=new Slick.Group();AY.count=0;AY.value=AU;AY.rows=[];AW[AW.length]=AY;AV[AU]=AY}AY.rows[AY.count++]=AX}return AW}function Ax(AS){if(AS.collapsed&&!c){return}var AU=new Slick.GroupTotals();var AT,AV=Az.length;while(AV--){AT=Az[AV];AT.init();AM[AV].call(AT,AS.rows);AT.storeResult(AU)}AU.group=AS;AS.totals=AU}function AH(AS){var AT=AS.length;while(AT--){Ax(AS[AT])}}function G(AS){var AT=AS.length,AU;while(AT--){AU=AS[AT];AU.collapsed=(AU.value in AQ);AU.title=q?q(AU):AU.value}}function f(AY){var AZ=[],AW=0,AX;for(var AS=0,AU=AY.length;AS<AU;AS++){AX=AY[AS];AZ[AW++]=AX;if(!AX.collapsed){for(var AT=0,AV=AX.rows.length;AT<AV;AT++){AZ[AW++]=AX.rows[AT]}}if(AX.totals&&(!AX.collapsed||c)){AZ[AW++]=AX.totals}}return AZ}function Z(AS){var AT=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var AU=AS.toString().match(AT);return{params:AU[1].split(","),body:AU[2]}}function a(AU){var AT=Z(AU.accumulate);var AS=new Function("_items","for (var "+AT.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+AT.params[0]+" = _items[_i]; "+AT.body+"}");AS.displayName=AS.name="compiledAccumulatorLoop";return AS}function u(){var AV=Z(s);var AT=AV.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }");var AU=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");AU=AU.replace(/\$filter\$/gi,AT);AU=AU.replace(/\$item\$/gi,AV.params[0]);AU=AU.replace(/\$args\$/gi,AV.params[1]);var AS=new Function("_items,_args",AU);AS.displayName=AS.name="compiledFilter";return AS}function Ao(){var AV=Z(s);var AT=AV.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }");var AU=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");AU=AU.replace(/\$filter\$/gi,AT);AU=AU.replace(/\$item\$/gi,AV.params[0]);AU=AU.replace(/\$args\$/gi,AV.params[1]);var AS=new Function("_items,_args,_cache",AU);AS.displayName=AS.name="compiledFilterWithCaching";return AS}function Ae(AU,AS){var AT=[],AX=0;for(var AV=0,AW=AU.length;AV<AW;AV++){if(s(AU[AV],AS)){AT[AX++]=AU[AV]}}return AT}function AK(AT,AW,AY){var AZ=[],AV=0,AU;for(var AS=0,AX=AT.length;AS<AX;AS++){AU=AT[AS];if(AY[AS]){AZ[AV++]=AU}else{if(s(AU,AW)){AZ[AV++]=AU;AY[AS]=true}}}return AZ}function P(AU){if(s){var AS=S.inlineFilters?As:Ae;var AT=S.inlineFilters?x:AK;if(AG.isFilterNarrowing){r=AS(r,Am)}else{if(AG.isFilterExpanding){r=AT(AU,Am,J)}else{if(!AG.isFilterUnchanged){r=AS(AU,Am)}}}}else{r=d?AU:AU.concat()}var AV;if(d){if(r.length<Q*d){Q=Math.floor(r.length/d)}AV=r.slice(d*Q,d*Q+d)}else{AV=r}return{totalRows:r.length,rows:AV}}function m(AT,A0){var AU,AZ,AV,AX=[];var AW=0,A1=A0.length;if(AG&&AG.ignoreDiffsBefore){AW=Math.max(0,Math.min(A0.length,AG.ignoreDiffsBefore))}if(AG&&AG.ignoreDiffsAfter){A1=Math.min(A0.length,Math.max(0,AG.ignoreDiffsAfter))}for(var AS=AW,AY=AT.length;AS<A1;AS++){if(AS>=AY){AX[AX.length]=AS}else{AU=A0[AS];AZ=AT[AS];if((T&&(AV=(AU.__nonDataRow)||(AZ.__nonDataRow))&&AU.__group!==AZ.__group||AU.__updated||AU.__group&&!AU.equals(AZ))||(Az&&AV&&(AU.__groupTotals||AZ.__groupTotals))||AU[h]!=AZ[h]||(b&&b[AU[h]])){AX[AX.length]=AS}}}return AX}function O(AV){Ab=null;if(AG.isFilterNarrowing!=Av.isFilterNarrowing||AG.isFilterExpanding!=Av.isFilterExpanding){J=[]}var AS=P(AV);An=AS.totalRows;var AT=AS.rows;Ai=[];if(T!=null){Ai=N(AT);if(Ai.length){G(Ai);if(Az){AH(Ai)}Ai.sort(Ay);AT=f(Ai)}}var AU=m(AE,AT);AE=AT;return AU}function n(){if(U){return}var AU=AE.length;var AT=An;var AS=O(AB,s);if(d&&An<Q*d){Q=Math.max(0,Math.ceil(An/d)-1);AS=O(AB,s)}b=null;Av=AG;AG={};if(AT!=An){AO.notify(t(),null,AF)}if(AU!=AE.length){Ar.notify({previous:AU,current:AE.length},null,AF)}if(AS.length>0){Ad.notify({rows:AS},null,AF)}}function R(AS,AW){var AV=this;var AT=AV.mapRowsToIds(AS.getSelectedRows());var AU;AS.onSelectedRowsChanged.subscribe(function(AY,AX){if(AU){return}AT=AV.mapRowsToIds(AS.getSelectedRows())});this.onRowsChanged.subscribe(function(AZ,AX){if(AT.length>0){AU=true;var AY=AV.mapIdsToRows(AT);if(!AW){AT=AV.mapRowsToIds(AY)}AS.setSelectedRows(AY);AU=false}})}function Ap(AS,AT){var AV;var AW;AU(AS.getCellCssStyles(AT));function AU(AY){AV={};for(var AZ in AY){var AX=AE[AZ][h];AV[AX]=AY[AZ]}}AS.onCellCssStylesChanged.subscribe(function(AY,AX){if(AW){return}if(AT!=AX.key){return}if(AX.hash){AU(AX.hash)}});this.onRowsChanged.subscribe(function(A0,AY){if(AV){AW=true;AD();var A1={};for(var AX in AV){var AZ=Ab[AX];if(AZ!=undefined){A1[AZ]=AV[AX]}}AS.setCellCssStyles(AT,A1);AW=false}})}return{"beginUpdate":g,"endUpdate":K,"setPagingOptions":AL,"getPagingInfo":t,"getItems":Ac,"setItems":AC,"setFilter":W,"sort":z,"fastSort":At,"reSort":Aj,"groupBy":Aq,"setAggregators":AP,"collapseGroup":X,"expandGroup":Aw,"getGroups":AA,"getIdxById":e,"getRowById":M,"getItemById":Aa,"getItemByIdx":AR,"mapRowsToIds":H,"mapIdsToRows":Al,"setRefreshHints":Ak,"setFilterArgs":Au,"refresh":n,"updateItem":Af,"insertItem":AI,"addItem":w,"deleteItem":o,"syncGridSelection":R,"syncGridCellCssStyles":Ap,"getLength":AN,"getItem":V,"getItemMetadata":l,"getRows":AJ,"onRowCountChanged":Ar,"onRowsChanged":Ad,"onPagingInfoChanged":AO}}function B(G){this.field_=G;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(H){var I=H[this.field_];this.count_++;if(I!=null&&I!=""&&I!=NaN){this.nonNullCount_++;this.sum_+=parseFloat(I)}};this.storeResult=function(H){if(!H.avg){H.avg={}}if(this.nonNullCount_!=0){H.avg[this.field_]=this.sum_/this.nonNullCount_}}}function A(G){this.field_=G;this.init=function(){this.min_=null};this.accumulate=function(H){var I=H[this.field_];if(I!=null&&I!=""&&I!=NaN){if(this.min_==null||I<this.min_){this.min_=I}}};this.storeResult=function(H){if(!H.min){H.min={}}H.min[this.field_]=this.min_}}function E(G){this.field_=G;this.init=function(){this.max_=null};this.accumulate=function(H){var I=H[this.field_];if(I!=null&&I!=""&&I!=NaN){if(this.max_==null||I>this.max_){this.max_=I}}};this.storeResult=function(H){if(!H.max){H.max={}}H.max[this.field_]=this.max_}}function C(G){this.field_=G;this.init=function(){this.sum_=null};this.accumulate=function(H){var I=H[this.field_];if(I!=null&&I!=""&&I!=NaN){this.sum_+=parseFloat(I)}};this.storeResult=function(H){if(!H.sum){H.sum={}}H.sum[this.field_]=this.sum_}}})(jQuery);(function(B){B.extend(true,window,{"Slick":{"RowSelectionModel":A,"RowMoveManager":C}});function A(L){var D;var W=[];var T=this;var O=new Slick.EventHandler();var J;var U;var N={selectActiveRow:true};function Q(Y){U=B.extend(true,{},N,L);D=Y;O.subscribe(D.onActiveCellChanged,V(I));O.subscribe(D.onKeyDown,V(E));O.subscribe(D.onClick,V(S))}function F(){O.unsubscribeAll()}function V(Y){return function(){if(!J){J=true;Y.apply(this,arguments);J=false}}}function G(a){var b=[];for(var Z=0;Z<a.length;Z++){for(var Y=a[Z].fromRow;Y<=a[Z].toRow;Y++){b.push(Y)}}return b}function X(b){var a=[];var Y=D.getColumns().length-1;for(var Z=0;Z<b.length;Z++){a.push(new Slick.Range(b[Z],0,b[Z],Y))}return a}function H(Y,Z){var a,b=[];for(a=Y;a<=Z;a++){b.push(a)}for(a=Z;a<Y;a++){b.push(a)}return b}function K(){return G(W)}function M(Y){P(X(Y))}function P(Y){W=Y;T.onSelectedRangesChanged.notify(W)}function R(){return W}function I(Y,Z){if(U.selectActiveRow){P([new Slick.Range(Z.row,0,Z.row,D.getColumns().length-1)])}}function E(c){var b=D.getActiveCell();if(b&&c.shiftKey&&!c.ctrlKey&&!c.altKey&&!c.metaKey&&(c.which==38||c.which==40)){var Z=K();Z.sort(function(e,f){return e-f});if(!Z.length){Z=[b.row]}var Y=Z[0];var d=Z[Z.length-1];var a;if(c.which==40){a=b.row<d||Y==d?++d:++Y}else{a=b.row<d?--d:--Y}if(a>=0&&a<D.getDataLength()){D.scrollRowIntoView(a);W=X(H(Y,d));P(W)}c.preventDefault();c.stopPropagation()}}function S(c){var b=D.getCellFromEvent(c);if(!b||!D.canCellBeActive(b.row,b.cell)){return false}var Z=G(W);var d=B.inArray(b.row,Z);if(!c.ctrlKey&&!c.shiftKey&&!c.metaKey){return false}else{if(D.getOptions().multiSelect){if(d===-1&&(c.ctrlKey||c.metaKey)){Z.push(b.row);D.setActiveCell(b.row,b.cell)}else{if(d!==-1&&(c.ctrlKey||c.metaKey)){Z=B.grep(Z,function(e,h){return(e!==b.row)});D.setActiveCell(b.row,b.cell)}else{if(Z.length&&c.shiftKey){var f=Z.pop();var a=Math.min(b.row,f);var g=Math.max(b.row,f);Z=[];for(var Y=a;Y<=g;Y++){if(Y!==f){Z.push(Y)}}Z.push(f);D.setActiveCell(b.row,b.cell)}}}}}W=X(Z);P(W);c.stopImmediatePropagation();return true}B.extend(this,{"getSelectedRows":K,"setSelectedRows":M,"getSelectedRanges":R,"setSelectedRanges":P,"init":Q,"destroy":F,"onSelectedRangesChanged":new Slick.Event()})}function C(D){var O;var L;var M;var P=this;var N=new Slick.EventHandler();var J={cancelEditOnDrag:false};function G(Q){D=B.extend(true,{},J,D);O=Q;L=O.getCanvasNode();N.subscribe(O.onDragInit,K).subscribe(O.onDragStart,H).subscribe(O.onDrag,I).subscribe(O.onDragEnd,F)}function E(){N.unsubscribeAll()}function K(R,Q){R.stopImmediatePropagation()}function H(T,Q){var U=O.getCellFromEvent(T);if(D.cancelEditOnDrag&&O.getEditorLock().isActive()){O.getEditorLock().cancelCurrentEdit()}if(O.getEditorLock().isActive()||!/move|selectAndMove/.test(O.getColumns()[U.cell].behavior)){return false}M=true;T.stopImmediatePropagation();var S=O.getSelectedRows();if(S.length==0||B.inArray(U.row,S)==-1){S=[U.row];O.setSelectedRows(S)}var R=O.getOptions().rowHeight;Q.selectedRows=S;Q.selectionProxy=B("<div class='slick-reorder-proxy'/>").css("position","absolute").css("zIndex","99999").css("width",B(L).innerWidth()).css("height",R*S.length).appendTo(L);Q.guide=B("<div class='slick-reorder-guide'/>").css("position","absolute").css("zIndex","99998").css("width",B(L).innerWidth()).css("top",-1000).appendTo(L);Q.insertBefore=-1}function I(T,Q){if(!M){return}T.stopImmediatePropagation();var R=T.pageY-B(L).offset().top;Q.selectionProxy.css("top",R-5);var U=Math.max(0,Math.min(Math.round(R/O.getOptions().rowHeight),O.getDataLength()));if(U!==Q.insertBefore){var S={"rows":Q.selectedRows,"insertBefore":U};if(P.onBeforeMoveRows.notify(S)===false){Q.guide.css("top",-1000);Q.canMove=false}else{Q.guide.css("top",U*O.getOptions().rowHeight);Q.canMove=true}Q.insertBefore=U}}function F(S,Q){if(!M){return}M=false;S.stopImmediatePropagation();Q.guide.remove();Q.selectionProxy.remove();if(Q.canMove){var R={"rows":Q.selectedRows,"insertBefore":Q.insertBefore};P.onMoveRows.notify(R)}}B.extend(this,{"onBeforeMoveRows":new Slick.Event(),"onMoveRows":new Slick.Event(),"init":G,"destroy":E})}})(jQuery);(function(D){D.extend(true,window,{"Slick":{"Cell":{"SelectionModel":A,"CopyManager":B,"RangeToExcel":G,"RangeDecorator":E,"RangeSelector":F,"AutoTooltips":C}}});function A(O){var H;var T;var Y=[];var V=this;var Z=new Slick.Cell.RangeSelector({"selectionCss":{"border":"2px solid black"}});var W;var Q={selectActiveCell:true};var P=O.data;var J=O.columns;function S(a){W=D.extend(true,{},Q,O);H=a;T=H.getCanvasNode();H.onActiveCellChanged.subscribe(L);a.registerPlugin(Z);Z.onCellRangeSelected.subscribe(N);Z.onBeforeCellRangeSelected.subscribe(I)}function R(){H.onActiveCellChanged.unsubscribe(L);Z.onCellRangeSelected.unsubscribe(N);Z.onBeforeCellRangeSelected.unsubscribe(I);H.unregisterPlugin(Z)}function U(d){var b=[];for(var c=0;c<d.length;c++){var a=d[c];if(H.canCellBeSelected(a.fromRow,a.fromCell)&&H.canCellBeSelected(a.toRow,a.toCell)){b.push(a)}}return b}function X(a){Y=U(a)}function M(){return Y}function I(b,a){if(H.getEditorLock().isActive()){b.stopPropagation();return false}}function N(b,a){X([a.range]);K(a.range);V.onSelectedRangesChanged.notify(Y)}function L(b,a){if(W.selectActiveCell){X([new Slick.Range(a.row,a.cell)])}}function K(e){var g=e.fromRow;var l=e.fromCell;var f=e.toRow;var d=e.toCell;var c=0;var b;for(var a=0;a<=f-g;a++){for(var h=0;h<=d-l;h++){b=H.getCellNode(g+a,l+h);val=b.text();c=c+Number.tryParseFloat(val,0)}}setTimeout(function(){D(b).attr("title","如需复制，先按: Ctrl-C；后按：Ctrl-V粘贴。");D(b).tooltip()},2800);var b=H.getCellNode(f,d);setTimeout(function(){D(b).attr("title","合计："+c);D(b).tooltip()},1200)}D.extend(this,{"getSelectedRanges":M,"setSelectedRanges":X,"init":S,"destroy":R,"onSelectedRangesChanged":new Slick.Event()})}function B(R){var H;var d=this;var J;var Q;var T=R.data;var b=R.dataview;var L=R.columns;var S;var I=[{action:"note",bindType:"click",text:"批注",iconImage:"/Common/Content/default/js/slickgrid/images/sticky_note_plus.png"},{action:"copy",bindType:"click",text:"复制",iconImage:"/Common/Content/default/js/slickgrid/images/copy.png",newHorLine:true},{action:"paste",bindType:"click",text:"粘贴",iconImage:"/Common/Content/default/js/slickgrid/images/paste.png"},{action:"cancel",bindType:"click",text:"清除",newHorLine:true}];function Z(f){H=f;H.onKeyDown.subscribe(O);H.onContextMenu.subscribe(W);H.onClick.subscribe(K);S=D("<div class='slick-column-menu' style='display:none;position:absolute;z-index:20;'></div>").appendTo(document.body);N()}function U(){H.onKeyDown.unsubscribe(O);H.onContextMenu.unsubscribe(W);_grd.onClick.unsubscribe(K);S.remove();S=null}function O(g,f){if(H.getEditorLock().isActive()){return}if(g.which==D.ui.keyCode.ESCAPE){a(g)}if(g.which==67&&(g.ctrlKey||g.metaKey)){V(g)}if(g.which==86&&(g.ctrlKey||g.metaKey)){P(g)}}function V(g){var f=H.getSelectionModel().getSelectedRanges();if(f.length!=0){g.preventDefault();Q=f;Y(f);d.onCopyCells.notify({ranges:f})}}function Y(l){var f={};for(var h=0;h<l.length;h++){for(var g=l[h].fromRow;g<=l[h].toRow;g++){f[g]={};for(var m=l[h].fromCell;m<=l[h].toCell;m++){f[g][L[m].id]="copied"}}}H.setCellCssStyles("copy-manager",f)}function P(h){if(Q){h.preventDefault();c();var g=H.getSelectionModel().getSelectedRanges();if(g.length==0){var j=H.getCellFromEvent(h);if(j.row>=T.length){var f=new Slick.Range(j.row,j.cell,j.row,j.cell);g.push(f)}}X({from:Q,to:g});d.onPasteCells.notify({from:Q,to:g});Q=null}}function X(g){if(g.from.length!==1||g.to.length!==1){throw"this implementation only supports single range copy and paste operations."}var n;var f=g.from[0];var h=g.to[0];for(var l=0;l<=f.toRow-f.fromRow;l++){for(var m=0;m<=f.toCell-f.fromCell;m++){n=T[f.fromRow+l][L[f.fromCell+m].field];if((h.fromRow+l)>=T.length){T.push({});H.updateRowCount()}T[h.fromRow+l][L[h.fromCell+m].field]=n;H.invalidateRow(h.fromRow+l)}}H.invalidate();H.render();b.refresh()}function a(f){if(Q){f.preventDefault();d.onCopyCancelled.notify({ranges:Q});Q=null;c()}}function c(){H.removeCellCssStyles("copy-manager")}function N(){for(var j=0;j<I.length;j++){var l=I[j];if(l.newHorLine){D("<hr />").appendTo(S)}var f=D("<div class='slick-column-menuitem' id='divPopMenuItem1001'></div>").attr("title",l.text).appendTo(S);var m=D("<div class='slick-column-menuicon'></div>").appendTo(f);if(l.iconImage){m.css("background-image","url("+l.iconImage+")")}if(l.rightPopMenu){var g=D("<div class='slick-column-menupopicon' style='float:right'></div>").appendTo(f);g.css("background-image","url(/Common/Content/default/js/slickgrid/images/arrow-right.gif)")}var h=D("<span class='slick-column-menucontent'></span>").text(l.text).appendTo(f);f.bind("click",l,M)}}function W(g,f){g.preventDefault();J={row:f.row,cell:f.cell};S.css("top",g.pageY-5).css("left",g.pageX-10).fadeIn(150)}function M(h,f){h.preventDefault();h.stopPropagation();var g=h.data;if(g.bindType=="click"){if(g.action=="note"){d.onNoteCell.notify({cell:J})}else{if(g.action=="copy"){V(h)}else{if(g.action=="paste"){P(h)}else{if(g.action=="cancel"){a(h)}}}}}e()}function e(){if(S){S.hide()}}function K(f){e()}D.extend(this,{"init":Z,"destroy":U,"clearCopySelection":c,"onNoteCell":new Slick.Event(),"onCopyCells":new Slick.Event(),"onCopyCancelled":new Slick.Event(),"onPasteCells":new Slick.Event()})}function G(H){var H=jQuery.extend({separator:",",header:[],delivery:"popup"},H);var I=[];var Q=[];var N=this;var M=H.header.length;var P=[];var J=[];var R=0;function K(){if(M>0){for(var a=0;a<M;a++){P[P.length]=H.header[a]}}else{var b=H.columns;for(var V in b){var T=b[V];for(var U in T){if(U=="name"){if(T[U]!="<input type='checkbox'>"){P[P.length]=T[U]}else{P[P.length]=" "}}if(U=="id"){J[T[U]]=R++}}}}L(P);for(var V in H.dataview){var Y=H.dataview[V];var Z=[];for(var X in J){Z[J[X]]=Y[X]}L(Z)}var W=I.join("\n");if(H.delivery=="popup"){return O(W)}else{return W}}function L(T){var U=T.join("");var V="";if(T.length>0&&U!=""){V=T.join(H.separator)}I[I.length]=V}function O(T){if(D("#exportform")==null||D("#exportform").length==0){D("body").append('<form id="exportform" action="/Common/Common/Export" method="post"></form>')}$hidden=D("<input type='hidden' id='exportdata' name='exportdata'/>").appendTo(D("#exportform"));$hidden.val(T)}function S(){D("#exportform").submit().remove()}K();D.extend(this,{"exportExcel":S})}function E(H,M){var J;var I={selectionCss:{"zIndex":"9999","border":"2px dashed red"}};M=D.extend(true,{},I,M);function K(N){if(!J){J=D("<div></div>",{css:M.selectionCss}).css("position","absolute").appendTo(H.getCanvasNode())}var P=H.getCellNodeBox(N.fromRow,N.fromCell);var O=H.getCellNodeBox(N.toRow,N.toCell);J.css({top:P.top-1,left:P.left-1,height:O.bottom-P.top-2,width:O.right-P.left-2});return J}function L(){if(J){J.remove();J=null}}D.extend(this,{"show":K,"hide":L})}function F(H){var U;var R;var S;var J;var V=this;var T=new Slick.EventHandler();var P={selectionCss:{"border":"2px dashed blue"}};function K(W){H=D.extend(true,{},P,H);J=new Slick.Cell.RangeDecorator(W,H);U=W;R=U.getCanvasNode();T.subscribe(U.onDragInit,Q).subscribe(U.onDragStart,L).subscribe(U.onDrag,O).subscribe(U.onDragEnd,M)}function I(){T.unsubscribeAll()}function Q(X,W){X.stopImmediatePropagation()}function L(Y,W){var Z=U.getCellFromEvent(Y);if(V.onBeforeCellRangeSelected.notify(Z)!==false){if(U.canCellBeSelected(Z.row,Z.cell)){S=true;Y.stopImmediatePropagation()}}if(!S){return}var X=U.getCellFromPoint(W.startX-D(R).offset().left,W.startY-D(R).offset().top);W.range={start:X,end:{}};return J.show(new Slick.Range(X.row,X.cell))}function O(Y,W){if(!S){return}Y.stopImmediatePropagation();var X=U.getCellFromPoint(Y.pageX-D(R).offset().left,Y.pageY-D(R).offset().top);if(!U.canCellBeSelected(X.row,X.cell)){return}W.range.end=X;J.show(new Slick.Range(W.range.start.row,W.range.start.cell,X.row,X.cell))}function M(X,W){if(!S){return}S=false;X.stopImmediatePropagation();J.hide();V.onCellRangeSelected.notify({range:new Slick.Range(W.range.start.row,W.range.start.cell,W.range.end.row,W.range.end.cell)})}function N(X,W,Y){Y=Y||new Slick.EventData();W=W||{};W.grid=self;return X.notify(W,Y,self)}D.extend(this,{"init":K,"destroy":I,"onBeforeCellRangeSelected":new Slick.Event(),"onCellRangeSelected":new Slick.Event(),"onCellTested":new Slick.Event()})}function C(H){var M;var K=this;var J={maxToolTipLength:null};function I(P){H=D.extend(true,{},J,H);M=P;M.onMouseEnter.subscribe(O);M.onMouseLeave.subscribe(L)}function N(){M.onMouseEnter.unsubscribe(O);M.onMouseLeave.unsubscribe(L)}function O(S,P){var T=M.getCellFromEvent(S);if(T){var R=D(M.getCellNode(T.row,T.cell));var Q;if(R.innerWidth()<R[0].scrollWidth){Q=D.trim(R.text());if(H.maxToolTipLength&&Q.length>H.maxToolTipLength){Q=Q.substr(0,H.maxToolTipLength-3)+"..."}}else{Q=""}R.attr("title",Q)}}function L(R,P){var S=M.getCellFromEvent(R);if(S){var Q=M.getCellNode(S.row,S.cell);D(Q).attr("title","")}}D.extend(this,{"init":I,"destroy":N})}})(jQuery);(function(C){C.extend(true,window,{"Slick":{"CheckboxSelectColumn":B,"DropDownListColumn":A}});function B(K){var D;var S=this;var M=new Slick.EventHandler();var U={};var G=[];var H="chkbox_li00gong59_";var L={columnId:"_checkbox_selector",cssClass:null,toolTip:"选择/取消选择",width:30};var T=C.extend(true,{},L,K);function P(V){D=V;M.subscribe(D.onClick,R).subscribe(D.onHeaderClick,N).subscribe(D.onSelectedRowsChanged,O).subscribe(D.onKeyDown,E)}function F(){M.unsubscribeAll()}function E(W,V){if(W.which==32){if(D.getColumns()[V.cell].id===T.columnId){if(!D.getEditorLock().isActive()||D.getEditorLock().commitCurrentEdit()){J(V.row)}W.preventDefault();W.stopImmediatePropagation()}}}function R(W,V){if(D.getColumns()[V.cell].id===T.columnId&&C(W.target).is(":checkbox")){if(D.getEditorLock().isActive()&&!D.getEditorLock().commitCurrentEdit()){W.preventDefault();W.stopImmediatePropagation();return}D.getDataItem([V.row])["checked"]=W.target.checked;J(V.row);W.stopPropagation();W.stopImmediatePropagation();S.onCheckBoxClicked.notify({"row":V.row,"checked":W.target.checked})}}function J(V){if(U[V]){D.setSelectedRows(C.grep(D.getSelectedRows(),function(W){return W!=V}))}else{D.setSelectedRows(D.getSelectedRows().concat(V))}}function N(X,V){if(V.column.id==T.columnId&&C(X.target).is(":checkbox")){if(D.getEditorLock().isActive()&&!D.getEditorLock().commitCurrentEdit()){X.preventDefault();X.stopImmediatePropagation();return}if(C(X.target).is(":checked")){var Y=[];for(var W=0;W<D.getDataLength();W++){Y.push(W)}D.setSelectedRows(Y);C("input:checkbox.slick-checkbox-firstColumn").attr("checked","checked")}else{D.setSelectedRows([]);C("input:checkbox.slick-checkbox-firstColumn").removeAttr("checked")}X.stopPropagation();X.stopImmediatePropagation()}}function O(Z,V){var W=D.getSelectedRows();if(W.length==1){var X=V.rows[0];if(C.inArray(X,G)==-1){var Y=H+X;C("input:checkbox.slick-checkbox-firstColumn").removeAttr("checked");C("#"+Y).attr("checked","checked")}}G=W}function I(){return{id:T.columnId,name:"<input type='checkbox'>",toolTip:T.toolTip,field:"sel",width:T.width,resizable:false,sortable:false,cssClass:T.cssClass,formatter:Q}}function Q(b,Z,c,V,Y){if(Y){var X=H+b;var a="<input type='checkbox' class='slick-checkbox-firstColumn' id='"+X+"'";var W=Y;if(W.checked==true){a=a+" checked='checked'>"}else{a=a+">"}return a}return null}C.extend(this,{"init":P,"destroy":F,"onCheckBoxClicked":new Slick.Event(),"getColumnDefinition":I})}function A(D){var M;var N=this;var L=new Slick.EventHandler();var J={};var I={columnId:D.id,width:60};var K=C.extend(true,{},I,D);function H(O){M=O}function E(){L.unsubscribeAll()}function G(){return{id:K.columnId,name:K.name,field:K.field,fieldType:K.fieldType,hasFilter:K.hasFilter,dataSource:K.dataSource,width:K.width,resizable:false,sortable:false,formatter:F}}function F(W,U,S,Q,T){if(T){var Y=K.dataSource;var V="";var Z="<SELECT tabIndex='0' id='slt_"+Q.field+"' class='editor-select'><OPTION value='-1'></OPTION>";var P="</SELECT>";for(var O=0,X=Y.length;O<X;O++){if(T[Q.field]==Y[O].ID){V+="<OPTION value='"+Y[O].ID+"' selected='true'>"+Y[O].Text+"</OPTION>"}else{V+="<OPTION value='"+Y[O].ID+"'>"+Y[O].Text+"</OPTION>"}}var R=Z+V+P;return R}}C.extend(this,{"init":H,"destroy":E,"getColumnDefinition":G})}})(jQuery);(function(D){D.extend(true,window,{"Slick":{"Controls":{"Pager":B,"PagerSvr":C,"ColumnPicker":E,"filterDialog":A}}});function B(I,P,M){var G;function Q(){I.onPagingInfoChanged.subscribe(function(T,S){L(S)});H();L(I.getPagingInfo())}function K(){var U=!Slick.GlobalEditorLock.commitCurrentEdit();var S=I.getPagingInfo();var T=S.totalPages-1;return{canGotoFirst:!U&&S.pageSize!=0&&S.pageNum>0,canGotoLast:!U&&S.pageSize!=0&&S.pageNum!=T,canGotoPrev:!U&&S.pageSize!=0&&S.pageNum>0,canGotoNext:!U&&S.pageSize!=0&&S.pageNum<T,pagingInfo:S}}function F(S){I.setRefreshHints({isFilterUnchanged:true});I.setPagingOptions({pageSize:S})}function O(){if(K().canGotoFirst){I.setPagingOptions({pageNum:0})}}function N(){var S=K();if(S.canGotoLast){I.setPagingOptions({pageNum:S.pagingInfo.totalPages-1})}}function J(){var S=K();if(S.canGotoPrev){I.setPagingOptions({pageNum:S.pagingInfo.pageNum-1})}}function R(){var S=K();if(S.canGotoNext){I.setPagingOptions({pageNum:S.pagingInfo.pageNum+1})}}function H(){M.empty();var T=D("<span class='slick-pager-nav' />").appendTo(M);var S=D("<span class='slick-pager-settings' />").appendTo(M);G=D("<span class='slick-pager-status' />").appendTo(M);S.append("<span class='slick-pager-settings-expanded' style='display:none'>Show: <a data=0>All</a><a data='-1'>Auto</a><a data=25>25</a><a data=50>50</a><a data=100>100</a></span>");S.find("a[data]").click(function(Y){var X=D(Y.target).attr("data");if(X!=undefined){if(X==-1){var W=P.getViewport();F(W.bottom-W.top)}else{F(parseInt(X))}}});var V="<span class='ui-state-default ui-corner-all ui-icon-container'><span class='ui-icon ";var U="' /></span>";D(V+"ui-icon-lightbulb"+U).click(function(){D(".slick-pager-settings-expanded").toggle()}).appendTo(S);D(V+"ui-icon-seek-first"+U).click(O).appendTo(T);D(V+"ui-icon-seek-prev"+U).click(J).appendTo(T);D(V+"ui-icon-seek-next"+U).click(R).appendTo(T);D(V+"ui-icon-seek-end"+U).click(N).appendTo(T);M.find(".ui-icon-container").hover(function(){D(this).toggleClass("ui-state-hover")});M.children().wrapAll("<div class='slick-pager' />")}function L(T){var S=K();M.find(".slick-pager-nav span").removeClass("ui-state-disabled");if(!S.canGotoFirst){M.find(".ui-icon-seek-first").addClass("ui-state-disabled")}if(!S.canGotoLast){M.find(".ui-icon-seek-end").addClass("ui-state-disabled")}if(!S.canGotoNext){M.find(".ui-icon-seek-next").addClass("ui-state-disabled")}if(!S.canGotoPrev){M.find(".ui-icon-seek-prev").addClass("ui-state-disabled")}if(T.pageSize==0){G.text("Showing all "+T.totalRows+" rows")}else{G.text("Showing page "+(T.pageNum+1)+" of "+T.totalPages)}}Q()}function C(V,M,R,G,J){var S;var b=this;var Y=M.getGridId();var O=Y+"_txtGotoPageNum";var L=Y+"_txtPageRowsNum";var Z=Y+"_lblTotalPagesCount";var a,Q,I;function X(){P();T()}function N(){var e=!Slick.GlobalEditorLock.commitCurrentEdit();var d=R.totalPagesCount-1;return{canGotoFirst:!e&&R.pageSize!=0&&R.pageNum>0,canGotoLast:!e&&R.pageSize!=0&&R.pageNum!=d,canGotoPrev:!e&&R.pageSize!=0&&R.pageNum>0,canGotoNext:!e&&R.pageSize!=0&&R.pageNum<d,pagingInfo:R}}function H(){var d=N();if(d.canGotoFirst){var e=d.pagingInfo.pageSize;W(b.onDataPaged,{pageNum:0,pageSize:e})}}function U(){var d=N();if(d.canGotoNext){var e=d.pagingInfo.pageNum+1;var f=d.pagingInfo.pageSize;W(b.onDataPaged,{pageNum:e,pageSize:f})}}function F(){var d=N();if(d.canGotoPrev){var e=d.pagingInfo.pageNum-1;var f=d.pagingInfo.pageSize;W(b.onDataPaged,{pageNum:e,pageSize:f})}}function K(){var d=N();if(d.canGotoLast){var e=d.pagingInfo.totalPagesCount-1;var f=d.pagingInfo.pageSize;W(b.onDataPaged,{pageNum:e,pageSize:f})}}function c(g){if(a.val()!=a.val().replace(/[^0-9\.]/g,"")){var d=a.val().replace(/[^0-9\.]/g,"");a.text(d)}if(g.keyCode==13){var f=a.val();f=parseInt(f)-1;if(f!=undefined){if((f>=0)&&(f<=R.totalPagesCount)){W(b.onDataPaged,{pageNum:f,pageSize:R.pageSize})}}}}function P(){G.empty();var f=D("<span class='slick-pager-nav'/>").appendTo(G);var e=D("<span class='slick-pager-settings'/>").appendTo(G);S=D("<span class='slick-pager-status slick-pager-rows-number'/>").appendTo(G);e.append("<span class='slick-pager-settings-expanded' style='display:none'>每页显示: <input id='"+L+"' type='text' style='width:20px;'><a data=100>100</a><a data=200>200</a><a data=500>500</a></span>");Q=D("#"+L);e.find("a[data]").click(function(m){var l=D(m.target).attr("data");if(l!=undefined){Q.val("");if(l>0){W(b.onDataPaged,{pageNum:0,pageSize:l})}}});Q.keyup(function(m){if(this.value!=this.value.replace(/[^0-9\.]/g,"")){this.value=this.value.replace(/[^0-9\.]/g,"")}if(m.keyCode==13){var l=this.value;if(l!=undefined){if(l>0){W(b.onDataPaged,{pageNum:0,pageSize:l})}}}});var j="<span class='ui-state-default ui-corner-all ui-icon-container'><span style='display:inline-block;' class='ui-icon ";var g="' /></span>";D(j+"ui-icon-lightbulb"+g).click(function(){D(".slick-pager-settings-expanded").toggle();if(J.isCompact&&J.isCompact==true){D(".slick-pager-rows-number").toggle()}}).appendTo(e);D(j+"ui-icon-seek-first"+g).click(H).appendTo(f);D(j+"ui-icon-seek-prev"+g).click(F).appendTo(f);var d="<span class='slick-pager-status' style='vertical-align:top'><input id='"+O+"' type='text' style='width:15px;'/>/<label id='"+Z+"'></label>";var h="</span>";D(d+h).keyup(c).appendTo(f);a=D("#"+O);I=D("#"+Z);D(j+"ui-icon-seek-next"+g).click(U).appendTo(f);D(j+"ui-icon-seek-end"+g).click(K).appendTo(f);G.find(".ui-icon-container").hover(function(){D(this).toggleClass("ui-state-hover")});G.children().wrapAll("<div class='slick-pager'/>")}function T(){var d=N();G.find(".slick-pager-nav span").removeClass("ui-state-disabled");if(!d.canGotoFirst){G.find(".ui-icon-seek-first").addClass("ui-state-disabled")}if(!d.canGotoLast){G.find(".ui-icon-seek-end").addClass("ui-state-disabled")}if(!d.canGotoNext){G.find(".ui-icon-seek-next").addClass("ui-state-disabled")}if(!d.canGotoPrev){G.find(".ui-icon-seek-prev").addClass("ui-state-disabled")}var f;if(R.totalPagesCount!=0){var e=parseInt(R.pageNum);a.val(e+1);I.text(R.totalPagesCount)}S.text("每页: "+R.pageSize+" 共: "+R.totalRowsCount+" 条")}function W(f,d,g){g=g||new Slick.EventData();d=d||{};d.grid=b;return f.notify(d,g,b)}X();D.extend(this,{"onGoFirst":new Slick.Event(),"onGoNext":new Slick.Event(),"onGoPrev":new Slick.Event(),"onGoLast":new Slick.Event(),"onDataPaged":new Slick.Event()})}function E(G,l,T,S){var X;var I;var K;var f=this;var Z=Slick.Data.SlickColumnDefSimplify(G);var a={fadeSpeed:150};var R=[{action:"ascSort",bindType:"click",text:"升序",iconImage:"/Common/Content/default/js/slickgrid/images/sort_ascend.png"},{action:"descSort",bindType:"click",text:"降序",iconImage:"/Common/Content/default/js/slickgrid/images/sort_descend.png"},{action:"defaultSort",bindType:"click",text:"清除排序"},{action:"showColumns",bindType:"mouseover",text:"显示列",newHorLine:true,rightPopMenu:true,iconImage:"/Common/Content/default/js/slickgrid/images/column-chooser.gif"},{action:"resizeColumns",bindType:"mouseover",text:"列宽度",rightPopMenu:true,iconImage:"/Common/Content/default/js/slickgrid/images/column-format.png"},{action:"filterCurrentCol",bindType:"mouseover",text:"过滤(当前列)",newHorLine:true,rightPopMenu:true,iconImage:"/Common/Content/default/js/slickgrid/images/filter-single.png"},{action:"filterCompositor",bindType:"dialog",text:"过滤器(多列)",iconImage:"/Common/Content/default/js/slickgrid/images/filter-multiple.gif"},{action:"filterColumnsClear",bindType:"click",text:"清除过滤"}];function V(){l.onHeaderContextMenu.subscribe(c);l.onClick.subscribe(d);S=D.extend({},a,S);X=D("<div class='slick-column-menu' style='display:none;position:absolute;z-index:20;'></div>").appendTo(document.body);D(document.body).bind("mousedown",Y)}function c(q,p){q.preventDefault();K=p.column;if(!X){X=D("<div class='slick-column-menu'></div>").appendTo(document.body)}X.empty();o();X.css("top",q.pageY-5).css("left",q.pageX-10).fadeIn(S.fadeSpeed)}function o(){for(var s=0;s<R.length;s++){var t=R[s];if(t&&t.newHorLine){D("<hr />").appendTo(X)}var p=D("<div class='slick-column-menuitem' id='divPopMenuItem1001'></div>").attr("title",t.text).appendTo(X);var u=D("<div class='slick-column-menuicon'></div>").appendTo(p);if(t.iconImage){u.css("background-image","url("+t.iconImage+")")}if(t.rightPopMenu){var q=D("<div class='slick-column-menupopicon' style='float:right'></div>").appendTo(p);q.css("background-image","url(/Common/Content/default/js/slickgrid/images/arrow-right.gif)")}var r=D("<span class='slick-column-menucontent'></span>").text(t.text).appendTo(p);p.bind("mouseover",t,J).bind("click",t,O)}}var H=[];function J(t){t.preventDefault();t.stopPropagation();var p=t.data;if(p.bindType!="mouseover"){N();return}if(!I){I=D("<span class='slick-columnpicker' style='display:none;position:absolute;z-index:20;' />").appendTo(document.body)}I.empty();if(p.action=="resizeColumns"){$li=D("<li />").bind("click",e).appendTo(I);$input=D("<input type='checkbox' />").data("option","autoresize");D("<label />").text("自动列宽").prepend($input).appendTo($li);if(l.getOptions().forceFitColumns){$input.attr("checked","checked")}}else{if(p.action=="showColumns"){H=[];for(var s=0;s<G.length;s++){$li=D("<li />").appendTo(I);var q="chk_"+Math.ceil(Math.random()*1000000);$input=D("<input type='checkbox' id='"+q+"' />").bind("click",e).appendTo($li);if(G[s].id){$input.data("column-id",G[s].id)}if(l.getColumnIndex(G[s].id)!=null){$input.attr("checked","checked")}H.push($input);var u=G[s].name;if(G[s].id=="_checkbox_selector"){u="复选框"}D("<label />").text(u).prepend($input).appendTo($li)}}else{if(p.action=="filterCurrentCol"){var r=K.fieldType;if(r=="string"){$input=D("<input type='textbox' style='height:20px' />").data("column-id",K.id).bind("keyup",{"columnInfo":K,"operator":"contain"},n).appendTo(I)}else{if(r=="number"){M(I,"greater",">");M(I,"equal","=");M(I,"less","<")}else{if(r=="datetime"){Q(I,"greater",">");Q(I,"equal","=");Q(I,"less","<")}else{if(r=="boolean"){j(I,"equal","=")}else{if(r=="dropdownlist"){b(I,"greater",">");b(I,"equal","=");b(I,"less","<")}}}}}}}}I.css("top",t.pageY-20).css("left",X.offset().left+80).fadeIn(S.fadeSpeed)}function e(q){if(D(q.target).data("option")=="autoresize"){if(q.target.checked){l.setOptions({forceFitColumns:true});l.autosizeColumns()}else{l.setOptions({forceFitColumns:false})}return false}if(D(q.target).data("option")=="syncresize"){if(q.target.checked){l.setOptions({syncColumnCellResize:true})}else{l.setOptions({syncColumnCellResize:false})}return false}if(D(q.target).is(":checkbox")){var p=[];D.each(H,function(r,s){if(D(this).is(":checked")){p.push(G[r])}});if(!p.length){D(q.target).attr("checked","checked");return false}l.setColumns(p)}}function Y(p){if(I&&(I[0]!=p.target)&&(!D.contains(I[0],p.target))&&(p.target.className.indexOf("ui-state-default")==-1)){N()}if(X&&X[0]!=p.target&&!I&&!D.contains(X[0],p.target)){F()}}function d(p){N();F()}function F(){if(X){X.remove();X=null}}function N(){if(I){I.remove();I=null}}function O(t){t.preventDefault();t.stopPropagation();var q=t.data;if(q.bindType=="click"){if(q.action=="ascSort"){U(f.onDataColumnSort,{field:K.field,sort:"asc"})}else{if(q.action=="descSort"){U(f.onDataColumnSort,{field:K.field,sort:"desc"})}else{if(q.action=="defaultSort"){U(f.onDataColumnSort,{field:K.field,sort:"default"})}else{if(q.action=="filterColumnsClear"){W(K.field,K.fieldType)}}}}}else{if(q.bindType=="dialog"){var r=JSON.stringify(Z);setCookie("colDefEPProduct",r,1);var p="divFilterDialog_"+l.getGridId();var u=D("<div id='"+p+"' />").appendTo("body");var s=u.load("/Common/Content/default/js/slickgrid/control/slick.filterdialog.html",function(){var w={title:"多列过滤",width:450,height:500,position:"center",modal:false,resizable:true,autoOpen:false,close:function(y,x){D(this).dialog("destroy");D(this).remove()}};s.dialog(w).dialog("open")})}}}function M(r,p,q){$li=D("<li />").appendTo(I);$label=D("<label />").text(q).appendTo($li);$input=D("<input type=textbox' style='height:20px' />").data("column-id",K.id+"_"+p).bind("keyup",{"columnInfo":K,"operator":q},n).prependTo($label).appendTo($li)}function n(r,p){if(r.keyCode==13){var q=this.value;h(r.data.columnInfo.field,r.data.columnInfo.fieldType,r.data.operator,q)}}function Q(r,p,q){$li=D("<li />").appendTo(I);$label=D("<label />").text(q).appendTo($li);$datetime=D("<input type='text' style='height:20px' />").data("datetime-id",K.id+"_"+p).bind("change",{"columnInfo":K,"operator":q},P).prependTo($label).appendTo($li).datepicker()}function P(q){var p=this.value;h(q.data.columnInfo.field,q.data.columnInfo.fieldType,q.data.operator,p);N();F()}function j(r,p,q){$radio1=D("<input type='radio' name='filterradio' value='1' />").bind("change",{"columnInfo":K,"operator":"="},L).appendTo(I);$label1=D("<label />").text("是").prependTo($radio1).appendTo(I);$radio2=D("<input type='radio' name='filterradio' value='0' />").bind("change",{"columnInfo":K,"operator":"="},L).prependTo($radio1).appendTo(I);$label2=D("<label />").text("否").prependTo($radio1).appendTo(I)}function L(q){var p=this.value==1?"true":"false";h(q.data.columnInfo.field,q.data.columnInfo.fieldType,q.data.operator,p);N();F()}function b(q,u,s){$li=D("<li />").appendTo(I);$label=D("<label />").text(s).appendTo($li);var t=K;var z=K.dataSource;var w="";var Aa="<SELECT tabIndex='0' id='slt_"+K.field+"' class='editor-select' style='width:80px;height:20px;margin-left:5px'><OPTION value='-1'>...</OPTION>";var x="</SELECT>";for(var p=0,y=z.length;p<y;p++){w+="<OPTION value='"+z[p].ID+"'>"+z[p].Text+"</OPTION>"}var r=Aa+w+x;D(r).prependTo($label).bind("change",{"columnInfo":K,"operator":s},g).appendTo($li)}function g(q){var p=this.value;h(q.data.columnInfo.field,q.data.columnInfo.fieldType,q.data.operator,p);N();F()}function h(r,s,p,q){var u=m(r,s,p,q);var t={"field":r,"fieldType":s,"filterType":"single","expression":u};T.setFilterArgs(t);T.refresh()}function m(p,s,q,r){var t;p="["+p+"]";q=q=="="?"==":q;if(s=="string"){t=p+".indexOf('"+r+"')!=-1"}else{if(s=="number"){if(!r){r=0}t=p+q+r}else{if(s=="boolean"){t=p+q+parseBool(r)}else{if(s=="datetime"){t=p+q+Date.parse(r)}else{if(s=="dropdownlist"){t=p+q+r}else{throw new Error("未知的数据类型: "+s)}}}}}return t}function W(q,r){var p={"field":q,"fieldType":r,"filterType":"clear","expression":""};T.setFilterArgs(p);T.refresh()}function U(q,p,r){r=r||new Slick.EventData();p=p||{};p.grid=f;return q.notify(p,r,f)}V();D.extend(this,{"onDataColumnSort":new Slick.Event()})}function A(){var Ac;var q;var S;var I;var G;var H;var f="divLogicExpression";var g="divFilterContent";var a="divFilterExpression";var Ad;var N=[{action:"and",text:"并且",iconImage:"/Common/Content/default/js/slickgrid/images/sort_ascend.png"},{action:"or",text:"或者",iconImage:"/Common/Content/default/js/slickgrid/images/sort_descend.png"},{action:"addCondition",text:"添加条件",newHorLine:true},{action:"addGroup",text:"添加分组",iconImage:"/Common/Content/default/js/slickgrid/images/column-chooser.gif"},{action:"removeGroup",text:"清除分组",newHorLine:true,iconImage:"/Common/Content/default/js/slickgrid/images/column-format.png"},];var Z=window.getFilterSource();if(!Z){throw ("请查看SlickGrid页面有没有定义getFilterSource()方法！")}var U=Z.grid;var Q=Z.dataview;var J=Slick.Data.SlickColumnDefSimplify(U.getColumns());var h=[{"id":"greater","title":"大于","text":">"},{"id":"equal","title":"等于","text":"="},{"id":"less","title":"小于","text":"<"},{"id":"not-equal","title":"不等于","text":"!="},{"id":"greater-equal","title":"大于或等于","text":">="},{"id":"less-equal","title":"小于或等于","text":"<="}];function X(){D(document.body).bind("mousedown",p);F();var Ae=b();P(Ae,Ad);n(Ad,J[0])}function b(){var Ag=Math.random()*1000000;Ag=Math.floor(Ag);Ad=Ag;var Ae=f+"-"+Ag;var Af=D("<div id='"+Ae+"' exptype='logicGroupExp' headindex='"+Ag+"'></div>").appendTo(D("#divDialogContent"));return Af}function F(){Ac=Y(D("#divLogicPopMenu"));$fieldMenu=Ab(D("#divFieldPopMenu"));S=x(D("#divOperatorPopMenu"))}function Y(Ae){if(D(Ae)){D(Ae).empty()}for(var Ah=0;Ah<N.length;Ah++){var Ai=N[Ah];if(!Ai){continue}if(Ai.newHorLine){D("<hr />").appendTo(D(Ae))}var Af=D("<div class='slick-column-menuitem' id='divPopMenuItem1001'></div>").attr("title",Ai.text).appendTo(D(Ae));var Aj=D("<div class='slick-column-menuicon'></div>").appendTo(Af);if(Ai.iconImage){Aj.css("background-image","url("+Ai.iconImage+")")}var Ag=D("<span class='slick-column-menucontent'></span>").text(Ai.text).appendTo(Af);Af.bind("click",Ai,o)}return D(Ae)}function Ab(Ae){if(D(Ae)){D(Ae).empty()}for(var Ah=0;Ah<J.length;Ah++){var Ag=J[Ah];var Af=D("<div class='slick-column-menuitem' ></div>").attr("title",Ag.name).appendTo(D(Ae));var Ai=D("<span class='slick-column-menucontent'></span>").text(Ag.name).appendTo(Af);Af.bind("click",Ag,m)}return D(Ae)}function x(Ae){if(D(Ae)){D(Ae).empty()}for(var Ah=0;Ah<h.length;Ah++){var Ai=h[Ah];var Af=D("<div class='slick-column-menuitem'></div>").attr("title",Ai.title).appendTo(D(Ae));var Ag=D("<span class='slick-column-menucontent'></span>").text(Ai.text).appendTo(Af);Af.bind("click",Ai,u)}return D(Ae)}function P(Ae,Af){$ahreflogiclink=D("<a href='#' class='hrefAndOrItem' exptype='logicOperatorExp' headindex='"+Af+"'>and</a>").bind("click",M).appendTo(Ae);$imgLogicItemNew=D("<img src='/Common/Content/default/js/slickgrid/images/insert-new.png' class='hrefImageLogicItemNew'/>").bind("click",{"headindex":Af},K).appendTo(Ae);var Ag=g;if(Af!=0){Ag=Ag+"-"+Af}$filterContentNew=D("<div id='"+Ag+"' exptype='expressionContent' headindex='"+Af+"'></div>").appendTo(Ae)}function O(){var Ah=Math.random()*1000000;Ah=Math.floor(Ah);var Ag=I.parent().children("[exptype='expressionContent']")[0];var Ae=f+"-"+Ah;var Af=D("<div id='"+Ae+"' style='float:left;' exptype='logicGroupExp' headindex='"+Ah+"'></div>").appendTo(D(Ag));P(Af,Ah);n(Ah,J[0])}function n(Al,Aj,Am){var Ae=Math.random()*1000000;Ae=Math.floor(Ae);var Ai=g;if(Al!="0"){Ai=g+"-"+Al}var An=D("#"+Ai);var Ag=a+"-"+Ae;$filterBlock=D("<div id='"+Ag+"' style='width:400px;' class='cssFilterExpression' exptype='expression' headindex='"+Al+"' expressionindex='"+Ae+"'></div>");if(Am!=undefined&&Am!=null){$filterBlock.insertAfter(Am)}else{$filterBlock.appendTo(An)}$fieldNameDiv=D("<div style='width:110px;float:left;'></div>").appendTo($filterBlock);$fieldNameLink=D("<a href='#' id='ahrefFieldName' exptype='parameterExp' style='margin-left:20px;margin-right:20px;' field='"+Aj.field+"' fieldtype='"+Aj.fieldType+"' headindex='"+Al+"' expressionindex='"+Ae+"'>"+Aj.name+"</a>").bind("click",l).appendTo($fieldNameDiv);$operatorDiv=D("<div style='width:30px;height:20px;float:left;'></div>").appendTo($filterBlock);$operatorLink=D("<a href='#' id='ahrefOperator' exptype='binaryExp' style='margin-right:20px'>=</a>").bind("click",V).appendTo($operatorDiv);$filterValueDiv=D("<div style='width:230px;float:left;'></div>").appendTo($filterBlock);var Ah=Aj.fieldType;if(Ah=="datetime"){$filterValue=D("<input type='text' exptype='constantExp' style='width:200px'/>").data("datetime-id",Al).appendTo($filterValueDiv).datepicker()}else{if(Ah=="boolean"){$filterValue=D("<input type='checkbox' exptype='constantExp'/>").appendTo($filterValueDiv)}else{if(Ah=="dropdownlist"){var Ak=z(Aj.field);$filterValue=D(Ak).appendTo($filterValueDiv)}else{$filterValue=D("<input type='text' exptype='constantExp' style='width:200px'/>").appendTo($filterValueDiv)}}}var Af=D("<div style='vertical-align: middle;text-align: center;'></div>").appendTo($filterBlock);$imgFilterItemDel=D("<img src='/Common/Content/default/js/slickgrid/images/insert-del-grey.png' class='hrefImageFilterItemDel' style='display: block; margin-top: 5px;'/>").bind("click",{"expressionindex":Ae},Aa).appendTo(Af)}function z(Ag){var Ah="";var Al="<SELECT class='editor-select' exptype='constantExp' style='width:180px;height:20px;margin-left:5px'><OPTION value='-1'>...</OPTION>";var Ai="</SELECT>";var Ak=Slick.Data.SlickColumnDataSource(U.getColumns(),Ag);for(var Ae=0,Aj=Ak.length;Ae<Aj;Ae++){Ah+="<OPTION value='"+Ak[Ae].ID+"'>"+Ak[Ae].Text+"</OPTION>"}var Af=Al+Ah+Ai;return Af}function M(Ae){I=D(this);Ac.css("top",Ae.pageY-195).css("left",Ae.pageX-300).fadeIn(150)}function l(Ae){G=D(this);$fieldMenu.css("top",Ae.pageY-195).css("left",Ae.pageX-300).fadeIn(150)}function V(Ae){H=D(this);S.css("top",Ae.pageY-195).css("left",Ae.pageX-300).fadeIn(150)}function o(Ah){if(Ah.data.action=="and"||Ah.data.action=="or"){I.text(Ah.data.action)}else{if(Ah.data.action=="addCondition"){var Ae=I.parent().attr("headindex");var Af=D("#"+g+"-"+Ae);var Ag=Af.children("[exptype='expression']").last();n(Ae,J[0],Ag)}else{if(Ah.data.action=="addGroup"){O()}else{if(Ah.data.action=="removeGroup"){D(".cssFilterExpression").empty()}}}}t()}function m(Ah){var Ae=G.attr("headindex");var Af=G.attr("expressionindex");var Ag=D("#"+a+"-"+Af);n(Ae,Ah.data,Ag);Ag.remove();r()}function u(Ae){H.text(Ae.data.text);c()}function K(Ah){var Ae=Ah.data.headindex;var Af=D("#"+g+"-"+Ae);var Ag=Af.children("[exptype='expression']").last();n(Ae,J[0],Ag)}function Aa(Af){var Ag=Af.data.expressionindex;var Ae=D("#"+a+"-"+Ag);Ae.remove()}function p(Ae){if(Ac&&Ac[0]!=Ae.target&&!D.contains(Ac[0],Ae.target)){t()}if($fieldMenu&&$fieldMenu[0]!=Ae.target&&!D.contains($fieldMenu[0],Ae.target)){r()}if(S&&S[0]!=Ae.target&&!D.contains(S[0],Ae.target)){c()}}function t(){if(Ac){Ac.hide()}}function r(){if($fieldMenu){$fieldMenu.hide()}}function c(){if(S){S.hide()}}function W(Af,Ae,Ag){Ag=Ag||new Slick.EventData();Ae=Ae||{};Ae.grid=self;return Af.notify(Ae,Ag,self)}var e={};function L(){var Af=D("#"+f+"-"+Ad);var Ag=w(Af);var Ah={"field":J,"fieldType":"all","filterType":"complex","colRangeType":"multiplecolumn","expression":Ag};Q.setFilterArgs(Ah);Q.refresh();var Ae="divFilterDialog_"+U.getGridId();window.$("#"+Ae).dialog("close")}function w(Ah){var Ai=Ah.children("[exptype='logicOperatorExp']")[0];var Ae=D(Ai).text();var Af=Ah.children("[exptype='expressionContent']")[0];var Ag=d(Ae,D(Af));return Ag}function d(Ak,Ag){var Am;if(Ak=="and"){Am=" && "}else{if(Ak=="or"){Am=" || "}}var Ah="";var Al="";var Ai=Ag.children("[exptype]");for(var Ae=0;Ae<Ai.length;Ae++){var Af=D(Ai[Ae]);var Aj=Af.attr("exptype");if(Aj=="expression"){Ah=j(Af)}else{if(Aj=="logicGroupExp"){Ah=w(Af)}}if(Al!=""){Al+=Am}Al+=Ah}if(Ak=="or"){Al="("+Al+")"}return Al}function j(Af){var Ag="";var Al=D("div > a[exptype='parameterExp']",Af);var Ai=D(Al[0]).attr("field");var Ah=D(Al[0]).attr("fieldtype");var Am="["+Ai+"]";var Aj=D("div > a[exptype='binaryExp']",Af);var Ae=Aj[0].innerText?Aj[0].innerText:Aj[0].text;var An=R(Ae);var Ak=T(Af,Ah);Ag=s(Ah,Am,An,Ak);return Ag}function R(Af){var Ae=Af=="="?"==":Af;return Ae}function T(Ag,Ae){var Af;var Ah;if(Ae=="dropdownlist"){Ah=D("div > select[exptype='constantExp']",Ag);Af=D(Ah[0]).val();if(Af=="-1"){Af=null}}else{if(Ae=="boolean"){Ah=D("div > input[exptype='constantExp']",Ag);Af=Ah[0].checked}else{Ah=D("div > input[exptype='constantExp']",Ag);Af=Ah[0].value;if(Af==""){Af=null}}}return Af}function s(Ai,Ae,Af,Ah){var Ag;var Aj=Ae;if(!(Ai=="string"&&Af=="==")){Aj+=Af}if(Ai=="string"){if(Af=="=="){Ag=".indexOf('"+Ah+"') != -1"}else{Ag="'"+Ah+"'"}}else{if(Ai=="number"){Ag=Ah}else{if(Ai=="boolean"){Ag=Boolean(Ah)}else{if(Ai=="datetime"){Ag=Date.parse(Ah)}else{if(Ai=="dropdownlist"){Ag=Ah}else{throw new Error("未知的数据类型: "+Ai)}}}}}Aj+=Ag;return Aj}function y(){var Ae="divFilterDialog_"+U.getGridId();window.$("#"+Ae).dialog("close")}X();D.extend(this,{"buildExpression":L,"closeWindow":y})}})(jQuery);(function(C){C.extend(true,window,{"Slick":{"Plugins":{"HeaderMenu":A,"HeaderButtons":B}}});function A(N){var M;var Z;var c=this;var d=new Slick.EventHandler();var T={buttonCssClass:null,buttonImage:"/Common/Content/default/js/slickgrid/images/down.gif"};var S;var a;var h=N.dataview;var P={"BLANK":"hz16-ligongwangtr2013-filter-keywords-1002","NONBLANK":"hz16-ligongwangtr2013-filter-keywords-1001","ALL":"hz16-ligongwangtr2013-filter-keywords-1000"};var D=[];var W=[{ID:P.BLANK,Text:"(空值)",itemValueType:"blank",checked:"false"},{ID:P.NONBLANK,Text:"(非空值)",itemValueType:"non-blank",checked:"false"},{ID:P.ALL,Text:"(全部)",itemValueType:"all",checked:"false"}];function b(j){N=C.extend(true,{},T,N);M=j;d.subscribe(M.onHeaderCellRendered,J).subscribe(M.onBeforeHeaderCellDestroy,e);Z=M.getColumns();f(Z);M.setColumns(Z);C(document.body).bind("mousedown",E);M.onClick.subscribe(L)}function f(m){for(var l=0;l<m.length;l++){var j=m[l].hasFilter;if(j){m[l].header={headerMenu:{items:[]}}}}}function J(n,j){var o=j.column;var m=o.header&&o.header.headerMenu;if(m){var l=C("<div></div>").addClass("slick-header-menubutton").data("column",o).data("headerMenu",m);if(N.buttonCssClass){l.addClass(N.buttonCssClass)}if(N.buttonImage){l.css("background-image","url("+N.buttonImage+")")}if(m.tooltip){l.attr("title",menul.tooltip)}l.bind("click",K).appendTo(j.node)}}function e(l,j){var m=j.column;if(m.header&&m.header.headerMenu){C(j.node).find(".slick-header-menubutton").remove()}}function K(n){var m=C(this);var p=m.data("column");var l=R(p.field);S=C("<div class='slick-header-menu'></div>").appendTo(document.body);if(l){X(l.rawData,p);I(m);return}var j=[];Q(j,p);X(j,p);I(m);var o={};o["column"]=p.field;o["rawData"]=j;D.push(o)}function R(m){var j=jQuery.grep(D,function(n){return n.column==m});var l;if(j&&j.length==1){l=j[0]}return l}function Q(p,q){var n=C.map(W,function(r){return C.extend(true,{},r)});p.push.apply(p,n);if(q.fieldType=="dropdownlist"){var l=q.dataSource;for(var j=0;j<l.length;j++){p.push({ID:l[j].ID,Text:l[j].Text,itemValueType:"dataItem"})}}else{var m=h.getItems();var o=F(m,q.field);for(var j=0;j<o.length;j++){p.push({ID:j,Text:o[j],itemValueType:"dataItem"})}}}function X(l,p){S.empty();var m,n;var r,q;for(var j=0;j<l.length;j++){m=l[j];r=C("<div class='slick-header-menuitem'></div>").data("itemValueType",m.itemValueType||"").data("column",p).data("item",m).bind("click",U).appendTo(S);if(m.disabled){r.addClass("slick-header-menuitem-disabled")}if(m.tooltip){r.attr("title",m.tooltip)}var o;if(m.itemValueType!="dataItem"){o="single"}else{o="multiple"}n=m.checked;if(n==true){q=C("<input type='checkbox' filterType='"+o+"' belongs='"+p.field+"' checked='checked' style='margin-right:5px;'/>")}else{q=C("<input type='checkbox' filterType='"+o+"' belongs='"+p.field+"' style='margin-right:5px;'/>")}q.bind("click",O).appendTo(r);C("<span class='slick-header-menucontent'></span>").text(m.Text).appendTo(r)}}function O(o){var n=C(o.currentTarget).attr("belongs");var m=C(this).parent().data("item").Text;var l=R(n).rawData;var j=jQuery.grep(l,function(q){return q.Text==m});var p=j[0];if(o.currentTarget.checked==true){p.checked=true}else{p.checked=false}}function I(j){S.css("top",j.offset().top+j.height()).css("left",j.offset().left);a=j.closest(".slick-header-column");a.addClass("slick-header-column-active");S.show()}function F(l,m){var n,j=l.length,o=[],p={};for(n=0;n<j;n++){p[l[n][m]]=0}for(n in p){o.push(n)}return o}function U(p){var j=C(this).data("itemValueType");var t=C(this).data("column");var m;var l=C(this).data("item");if(l.disabled){return}var o;if(j!=undefined){var n="["+String(t.field)+"]";var s;var q=C("div.slick-header-menu :checkbox[belongs='"+t.field+"']");for(var r=0;r<q.length;r++){s=q[r];if(s.checked){l=C(s).parent().data("item");if(C(s).attr("filterType")=="single"){if(l.ID==P.ALL){m="1 == 1"}else{if(l.ID==P.NONBLANK){m=n+"!= null"}else{if(l.ID==P.BLANK){m=n+"== null"}}}if(o==undefined){o=m}else{o=o+" || ";o=o+m}}else{if(C(s).attr("filterType")=="multiple"){if(o==undefined){o=G(t,n,l,s)}else{o=o+" || ";o=o+G(t,n,l,s)}}}}}if(o==undefined){o=" 1==1 "}H(t.field,o);p.stopPropagation()}}function H(p,m){var o=R(p);o.expression=m;var n="";for(var l=0;l<D.length;l++){var j=D[l];if(n&&j.expression){n+=" && "}n=n+"("+j.expression+")"}filterArgs={"field":Z,"fieldType":"all","filterType":"complex","colRangeType":"multiplecolumn","expression":n};h.setFilterArgs(filterArgs);h.refresh()}function G(l,j,n,o){var m;if(l.fieldType=="dropdownlist"){m=j+"=="+n.ID}else{if(l.fieldType=="string"){m=j+"=='"+n.Text+"'"}else{if(l.fieldType=="number"){m=j+"=="+n.Text}else{if(l.fieldType=="boolean"){m=j+"=="+parseBool(n.Text)}else{if(l.fieldType=="datetime"){m=j+"=="+Date.parse(n.Text)}else{throw new Error("未知的数据类型或处理方式!")}}}}}return m}function V(){d.unsubscribeAll();C(document.body).unbind("mousedown",E)}function E(j){if(S&&S[0]!=j.target&&!C.contains(S[0],j.target)){g()}}function g(){if(S){S.hide();S.remove();a.removeClass("slick-header-column-active")}}function L(){g()}function Y(l,j,m){m=m||new Slick.EventData();j=j||{};j.grid=c;return l.notify(j,m,c)}C.extend(this,{"init":b,"destroy":V,"onClickCommand":new Slick.Event()})}function B(D){var J;var M=this;var K=new Slick.EventHandler();var G={buttonCssClass:"slick-header-button"};function E(N){D=C.extend(true,{},G,D);J=N;K.subscribe(J.onHeaderCellRendered,F).subscribe(J.onBeforeHeaderCellDestroy,H);J.setColumns(J.getColumns())}function L(){K.unsubscribeAll()}function F(Q,N){var S=N.column;if(S.header&&S.header.buttons){var P=S.header.buttons.length;while(P--){var O=S.header.buttons[P];var R=C("<div></div>").addClass(D.buttonCssClass).data("column",S).data("button",O);if(O.showOnHover){R.addClass("slick-header-button-hidden")}if(O.image){R.css("backgroundImage","url("+O.image+")")}if(O.cssClass){R.addClass(O.cssClass)}if(O.tooltip){R.attr("title",O.tooltip)}if(O.command){R.data("command",O.command)}if(O.handler){R.bind("click",O.handler)}R.bind("click",I).appendTo(N.node)}}}function H(O,N){var P=N.column;if(P.header&&P.header.buttons){C(N.node).find("."+D.buttonCssClass).remove()}}function I(P){var N=C(this).data("command");var O=C(this).data("column");var Q=C(this).data("button");if(N!=null){M.onCommand.notify({"grid":J,"column":O,"command":N,"button":Q},P,M);J.updateColumnHeader(O.id)}P.preventDefault();P.stopPropagation()}C.extend(this,{"init":E,"destroy":L,"onCommand":new Slick.Event()})}})(jQuery);(function($){$.extend(true,window,{"Slick":{"Data":{"SlickFilter":SlickFilter,"SlickColumnDefSimplify":SlickColumnDefSimplify,"SlickColumnDataSource":SlickColumnDataSource,"SlickExpressionFormatted":SlickExpressionFormatted,"SlickExpressionFieldType":SlickExpressionFieldType}}});function SlickColumnDefSimplify(columns){var col;var simpleCol=[];for(var i=0;i<columns.length;i++){if(columns[i].id=="_checkbox_selector"){continue}var hasFilter=columns[i].hasFilter;if(!hasFilter||hasFilter==false){continue}col={id:columns[i].id,name:columns[i].name,field:columns[i].field,fieldType:columns[i].fieldType,hasFilter:columns[i].hasFilter};simpleCol.push(col)}return simpleCol}function SlickColumnDataSource(columns,field){var column;for(var i=0;i<columns.length;i++){column=columns[i];if(column.field==field&&column.fieldType=="dropdownlist"){return column.dataSource}}return null}function SlickExpressionFormatted(fieldName,fieldType,expression,value){if(fieldType=="datetime"){expression=expression.replaceAll(fieldName,Date.parse(value))}else{if(fieldType=="string"){expression=expression.replaceAll(fieldName,"'"+value+"'")}else{expression=expression.replaceAll(fieldName,value)}}return expression}function SlickExpressionFieldType(colRangeType,colInfo,fieldName){var col,fieldType;if(colRangeType=="multiplecolumn"){for(var i=0;i<colInfo.length;i++){col=colInfo[i];if(col.field==fieldName){fieldType=col["fieldType"];break}}}else{if(colRangeType=="onecolumn"){if(colInfo.field==fieldName){fieldType=colInfo["fieldType"]}}}return fieldType}function SlickFilter(){function filterParser(item,args){var result=true;var valueExpression;var filterType=args.filterType;var expression=args.expression;if(filterType=="clear"){return true}else{if(filterType=="single"){var fieldName="["+args.field+"]";valueExpression=Slick.Data.SlickExpressionFormatted(fieldName,args.fieldType,expression,item[args.field]);result=eval(valueExpression)}else{if(filterType=="complex"){var fieldName,fieldNameBracket,fieldType;var colInfo=args.field;var regex=/\[([^\]]*)\]/g;while(match=regex.exec(expression)){fieldName=match[1];fieldNameBracket="["+fieldName+"]";fieldType=Slick.Data.SlickExpressionFieldType(args.colRangeType,colInfo,fieldName);expression=Slick.Data.SlickExpressionFormatted(fieldNameBracket,fieldType,expression,item[fieldName])}result=eval(expression)}}}return result}$.extend(this,{"filterParser":filterParser})}})(jQuery);